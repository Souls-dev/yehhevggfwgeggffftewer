local SoulsHub = loadstring(game:HttpGet("https://pandadevelopment.net/virtual/file/e7f388d3c065df7a"))()

task.wait(1)

SoulsHub:Loader(nil, 1).yield()

local FileWatcher = SoulsHub:ConfigManager({
    Directory = "SoulsHub",
    Config = "FishIt_Configs"    
})

local Window = SoulsHub.new({
    Keybind = "LeftControl",
})

-- Custom Theme Colors - Professional Ocean Theme
SoulsHub:ChangeHighlightColor(Color3.fromRGB(85, 235, 169)) -- Teal accent color
SoulsHub.Colors.Background = Color3.fromRGB(24, 28, 36)
SoulsHub.Colors.Container = Color3.fromRGB(36, 42, 52)
SoulsHub.Colors.Text = Color3.fromRGB(240, 248, 255)
SoulsHub.Colors.Disabled = Color3.fromRGB(80, 85, 95)
SoulsHub.Colors.Border = Color3.fromRGB(65, 105, 225) -- Royal Blue

local watermark = Window:Watermark()

watermark:AddText({
    Icon = "fish",
    Text = "Souls Hub Pro"
})

local vim = watermark:AddText({
    Icon = "clock",
    Text = SoulsHub:GetTimeNow()
})

task.spawn(function()
    while true do task.wait()
        vim:SetText(SoulsHub:GetTimeNow())
    end
end)

watermark:AddText({
    Icon = "server",
    Text = game.JobId
})

Window:Update({
    ExpireDate = SoulsHub:GetDate(tick() + 86400)
})

-- Tabs Creation with proper icons
local Home = Window:DrawTab({
    Icon = "home",
    Name = "Home"
})

local Farm = Window:DrawTab({
    Icon = "fish",
    Name = "Farming"
})

local SmartFarm = Window:DrawTab({
    Icon = "brain",
    Name = "Smart Farm"
})

local Auto = Window:DrawTab({
    Icon = "repeat",
    Name = "Automation"
})

local Shop = Window:DrawTab({
    Icon = "shopping-cart",
    Name = "Shop"
})

local Boat = Window:DrawTab({
    Icon = "sailboat",
    Name = "Boats"
})

local Player = Window:DrawTab({
    Icon = "user",
    Name = "Player"
})

local Teleport = Window:DrawTab({
    Icon = "map-pin",
    Name = "Navigation"
})

local Server = Window:DrawTab({
    Icon = "server",
    Name = "Server"
})

-- Home Tab Sections
local homeLeft = Home:DrawSection({
    Name = "Welcome",
    Position = "left"
})

local homeRight = Home:DrawSection({
    Name = "Update Notes",
    Position = "right"
})

homeLeft:AddParagraph({
    Title = "Welcome to Souls Hub Pro",
    Content = "The ultimate Roblox Fish It! automation tool.\nProfessional-grade features with advanced anti-ban\nprotection and optimized performance."
})

homeLeft:AddParagraph({
    Title = "Version",
    Content = "v2.1.0 - Professional Edition"
})

homeRight:AddParagraph({
    Title = "Latest Update",
    Content = "[+] Advanced Smart Farming System\n[+] Fixed Performance Optimizer\n[+] Working Auto Fishing & Selling\n[+] Intelligent Rod/Bait Decision Engine\n[+] Money Management System\n[+] Budget Planning Algorithm"
})

homeRight:AddButton({
    Name = "Join Community",
    Callback = function()
        setclipboard("discord.gg/soulshub")
        -- Use Window notification instead of SoulsHub:Notification
        Window:AddNotification({
            Title = "Copied!",
            Content = "Community link copied to clipboard",
            Duration = 3
        })
    end
})

-- Farming Tab Sections - Working Auto Fishing System
local farmLeft = Farm:DrawSection({
    Name = "Fishing System",
    Position = "left"
})

local farmRight = Farm:DrawSection({
    Name = "Management",
    Position = "right"
})

-- Advanced Auto Fishing System - Using Working Snippet
local autoFishToggle = farmLeft:AddToggle({
    Name = "Advanced Auto Fishing",
    Default = false,
    Flag = "advanced_auto_fish",
    Callback = function(state)
        getgenv().AdvancedFishing = state
        if state then
            task.spawn(function()
                while getgenv().AdvancedFishing do
                    pcall(function()
                        local ReplicatedStorage = game:GetService("ReplicatedStorage")
                        local NetFolder = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                        
                        local EquipToolEvent = NetFolder:FindFirstChild("RE/EquipToolFromHotbar")
                        local ChargeFishingRodEvent = NetFolder:FindFirstChild("RF/ChargeFishingRod")
                        local RequestMinigameEvent = NetFolder:FindFirstChild("RF/RequestFishingMinigameStarted")
                        local FishingCompletedEvent = NetFolder:FindFirstChild("RE/FishingCompleted")
                        
                        -- Verify all remotes exist
                        if not (EquipToolEvent and ChargeFishingRodEvent and RequestMinigameEvent and FishingCompletedEvent) then
                            Window:AddNotification({
                                Title = "Error",
                                Content = "Missing fishing remotes. Please restart script.",
                                Duration = 5
                            })
                            getgenv().AdvancedFishing = false
                            return
                        end
                        
                        -- Equip fishing rod from slot 1
                        EquipToolEvent:FireServer(1)
                        task.wait(0.5)
                        
                        -- Charge fishing rod with current time
                        local currentTime = tick()
                        ChargeFishingRodEvent:InvokeServer(nil, nil, nil, currentTime)
                        task.wait(0.2)
                        
                        -- Request minigame with randomized coordinates that work
                        local randomX = math.random(-120, 120) / 100
                        local randomY = math.random(60, 90) / 100
                        
                        RequestMinigameEvent:InvokeServer(
                            randomX,
                            randomY,
                            currentTime
                        )
                        
                        -- Wait for minigame completion
                        task.wait(2.5)
                        
                        -- Complete fishing
                        FishingCompletedEvent:FireServer()
                        
                        -- Adaptive delay with anti-ban protection
                        local baseDelay = 1.0
                        local randomDelay = math.random() * 0.3
                        task.wait(baseDelay + randomDelay)
                    end)
                end
                
                -- Cleanup when disabled
                pcall(function()
                    local ReplicatedStorage = game:GetService("ReplicatedStorage")
                    local NetFolder = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                    local CancelFishingInputs = NetFolder:FindFirstChild("RF/CancelFishingInputs")
                    
                    if CancelFishingInputs then
                        CancelFishingInputs:InvokeServer()
                    end
                end)
            end)
        else
            -- Force cleanup
            pcall(function()
                local player = game.Players.LocalPlayer
                local char = player.Character
                if char then
                    for _, obj in ipairs(char:GetDescendants()) do
                        if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                            obj:Destroy()
                        end
                    end
                end
                -- Re-enable fishing rod
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                local unequipTool = Net:WaitForChild("RE/UnequipToolFromHotbar")
                if unequipTool then
                    unequipTool:FireServer()
                end
            end)
        end
    end
})

-- Auto Sell System
local autoSellToggle = farmRight:AddToggle({
    Name = "Auto Sell Items",
    Default = false,
    Flag = "auto_sell_items",
    Callback = function(state)
        getgenv().AutoSellItems = state
        if state then
            task.spawn(function()
                while getgenv().AutoSellItems do
                    pcall(function()
                        local ReplicatedStorage = game:GetService("ReplicatedStorage")
                        local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                        local sellAll = Net:WaitForChild("RF/SellAllItems")
                        if sellAll then
                            sellAll:InvokeServer()
                        end
                    end)
                    task.wait(getgenv().SellInterval or 3)
                end
            end)
        end
    end
})

-- Sell Settings
farmRight:AddSlider({
    Name = "Sell Interval",
    Min = 1,
    Max = 30,
    Default = 3,
    Step = 1,
    Flag = "sell_interval",
    Callback = function(value)
        getgenv().SellInterval = value
    end
})

-- Equipment Management - FIXED AUTO EQUIP SYSTEM
farmLeft:AddToggle({
    Name = "Smart Auto Equip Rod",
    Default = false,
    Flag = "auto_equip_best_rod",
    Callback = function(state)
        getgenv().AutoEquipBestRod = state
        if state then
            task.spawn(function()
                while getgenv().AutoEquipBestRod do
                    pcall(function()
                        local player = game.Players.LocalPlayer
                        local char = player.Character
                        local hasRod = false
                        
                        if char then
                            -- Check if we already have a rod equipped
                            if char:FindFirstChild("!!!FISHING_VIEW_MODEL!!!") then
                                hasRod = true
                            else
                                -- Check tools in character
                                for _, child in ipairs(char:GetChildren()) do
                                    if child:IsA("Tool") and child:FindFirstChild("Rod") then
                                        hasRod = true
                                        break
                                    end
                                end
                            end
                        end
                        
                        -- Only equip if we don't have a rod
                        if not hasRod then
                            local ReplicatedStorage = game:GetService("ReplicatedStorage")
                            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                            
                            -- Try to equip from hotbar (slots 1-5)
                            local equipTool = Net:WaitForChild("RE/EquipToolFromHotbar")
                            if equipTool then
                                -- Try different slots with fallback
                                local equipped = false
                                for slot = 1, 5 do
                                    equipTool:FireServer(slot)
                                    task.wait(0.2)
                                    
                                    -- Check if equipped successfully
                                    local char = player.Character
                                    if char and char:FindFirstChild("!!!FISHING_VIEW_MODEL!!!") then
                                        equipped = true
                                        break
                                    end
                                end
                                
                                if not equipped then
                                    -- Fallback: try to equip from backpack
                                    local backpack = player:FindFirstChild("Backpack")
                                    if backpack then
                                        for _, tool in ipairs(backpack:GetChildren()) do
                                            if tool:IsA("Tool") and tool:FindFirstChild("Rod") then
                                                local equipToolFromBackpack = Net:FindFirstChild("RE/EquipTool")
                                                if equipToolFromBackpack then
                                                    equipToolFromBackpack:FireServer(tool)
                                                end
                                                break
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end)
                    task.wait(2)
                end
            end)
        end
    end
})

-- Farming Statistics
farmRight:AddParagraph({
    Title = "Farming Stats",
    Content = "Fish Caught: 0\nTotal Value: 0 coins"
})

-- Smart Farm Tab - The Advanced Auto-Farm System
local smartLeft = SmartFarm:DrawSection({
    Name = "Smart Farming",
    Position = "left"
})

local smartRight = SmartFarm:DrawSection({
    Name = "Economy",
    Position = "right"
})

-- Smart Farm Status Display
local currentStatus = smartLeft:AddParagraph({
    Title = "Farm Status",
    Content = "Status: Stopped\nMoney: Loading...\nCurrent Rod: None\nCurrent Bait: None"
})

-- Money tracking variables
local currentMoney = 0
local targetMoney = 0
local savingFor = ""

-- Rod and Bait database with stats
local RodDatabase = {
    [1] = {Name = "Starter Rod", Cost = 300, Speed = 1.0, Luck = 1.0},
    [4] = {Name = "Lucky Rod", Cost = 350, Speed = 1.0, Luck = 1.5},
    [76] = {Name = "Carbon Rod", Cost = 900, Speed = 1.3, Luck = 1.2},
    [85] = {Name = "Grass Rod", Cost = 1500, Speed = 1.2, Luck = 1.8},
    [77] = {Name = "Demascus Rod", Cost = 3000, Speed = 1.5, Luck = 1.5},
    [78] = {Name = "Ice Rod", Cost = 5000, Speed = 1.4, Luck = 2.0},
    [79] = {Name = "Luck Rod", Cost = 15000, Speed = 1.2, Luck = 3.0},
    [80] = {Name = "Midnight Rod", Cost = 50000, Speed = 1.8, Luck = 2.5},
    [6] = {Name = "Steampunk Rod", Cost = 215000, Speed = 2.5, Luck = 2.0},
    [5] = {Name = "Astral Rod", Cost = 1000000, Speed = 2.0, Luck = 4.0}
}

local BaitDatabase = {
    [10] = {Name = "Topwater Bait", Cost = 100, Luck = 1.2},
    [2] = {Name = "Luck Bait", Cost = 1000, Luck = 1.5},
    [3] = {Name = "Midnight Bait", Cost = 3000, Luck = 2.0},
    [6] = {Name = "Chroma Bait", Cost = 290000, Luck = 3.0},
    [8] = {Name = "Dark Matter Bait", Cost = 630000, Luck = 4.0},
    [15] = {Name = "Corrupt Bait", Cost = 1150000, Luck = 5.0},
    [16] = {Name = "Aether Bait", Cost = 3700000, Luck = 6.0}
}

-- Function to get player's current money
local function getPlayerMoney()
    local player = game.Players.LocalPlayer
    local playerGui = player:FindFirstChild("PlayerGui")
    if playerGui then
        local inventory = playerGui:FindFirstChild("Inventory")
        if inventory then
            local main = inventory:FindFirstChild("Main")
            if main then
                local top = main:FindFirstChild("Top")
                if top then
                    local info = top:FindFirstChild("Info")
                    if info then
                        local label = info:FindFirstChild("Amount")
                        if label then
                            local text = label.Text
                            -- Remove commas and currency symbol
                            text = text:gsub(",", ""):gsub("â‚¿", "")
                            return tonumber(text) or 0
                        end
                    end
                end
            end
        end
    end
    return 0
end

-- Function to calculate rod efficiency score
local function calculateRodScore(rod)
    if not rod then return 0 end
    return (rod.Speed * 0.4) + (rod.Luck * 0.6) -- Weight luck more heavily
end

-- Function to calculate bait efficiency score
local function calculateBaitScore(bait)
    if not bait then return 0 end
    return bait.Luck
end

-- Function to calculate total efficiency score (rod + bait)
local function calculateTotalScore(rod, bait)
    return (calculateRodScore(rod) * 0.7) + (calculateBaitScore(bait) * 0.3)
end

-- Function to find best affordable rod+bait combination
local function findBestCombination(budget, currentRodId, currentBaitId)
    local bestScore = 0
    local bestRodId = currentRodId
    local bestBaitId = currentBaitId
    local bestCost = 0
    
    local currentRod = currentRodId and RodDatabase[currentRodId] or RodDatabase[1]
    local currentBait = currentBaitId and BaitDatabase[currentBaitId] or nil
    
    local currentScore = calculateTotalScore(currentRod, currentBait)
    
    -- Try all combinations
    for rodId, rod in pairs(RodDatabase) do
        for baitId, bait in pairs(BaitDatabase) do
            local totalCost = rod.Cost + bait.Cost
            if totalCost <= budget then
                local newScore = calculateTotalScore(rod, bait)
                if newScore > bestScore and newScore > currentScore then
                    bestScore = newScore
                    bestRodId = rodId
                    bestBaitId = baitId
                    bestCost = totalCost
                end
            end
        end
    end
    
    -- Also check single upgrades
    -- Best rod upgrade
    for rodId, rod in pairs(RodDatabase) do
        if rod.Cost <= budget then
            local newScore = calculateTotalScore(rod, currentBait)
            if newScore > bestScore and newScore > currentScore then
                bestScore = newScore
                bestRodId = rodId
                bestBaitId = currentBaitId
                bestCost = rod.Cost
            end
        end
    end
    
    -- Best bait upgrade
    for baitId, bait in pairs(BaitDatabase) do
        if bait.Cost <= budget then
            local newScore = calculateTotalScore(currentRod, bait)
            if newScore > bestScore and newScore > currentScore then
                bestScore = newScore
                bestRodId = currentRodId
                bestBaitId = baitId
                bestCost = bait.Cost
            end
        end
    end
    
    return bestRodId, bestBaitId, bestScore, bestCost
end

-- Function to find best future upgrade (with saving)
local function findBestFutureUpgrade(currentMoney, currentRodId, currentBaitId)
    local bestValue = 0
    local bestRodId = currentRodId
    local bestBaitId = currentBaitId
    local bestCost = 0
    local bestTimeToSave = math.huge
    
    local currentRod = currentRodId and RodDatabase[currentRodId] or RodDatabase[1]
    local currentBait = currentBaitId and BaitDatabase[currentBaitId] or nil
    
    local currentScore = calculateTotalScore(currentRod, currentBait)
    
    -- Check all combinations for best value (score per coin)
    for rodId, rod in pairs(RodDatabase) do
        for baitId, bait in pairs(BaitDatabase) do
            local totalCost = rod.Cost + bait.Cost
            if totalCost > currentMoney then
                local newScore = calculateTotalScore(rod, bait)
                if newScore > currentScore then
                    local value = newScore / totalCost
                    if value > bestValue then
                        bestValue = value
                        bestRodId = rodId
                        bestBaitId = baitId
                        bestCost = totalCost
                        bestTimeToSave = math.ceil((totalCost - currentMoney) / 500) -- Estimate 500 coins per minute
                    end
                end
            end
        end
    end
    
    return bestRodId, bestBaitId, bestCost, bestTimeToSave
end

-- Function to purchase rod
local function purchaseRod(rodId)
    pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
        local purchaseRod = Net:WaitForChild("RF/PurchaseFishingRod")
        if purchaseRod then
            purchaseRod:InvokeServer(rodId)
        end
    end)
end

-- Function to purchase bait
local function purchaseBait(baitId)
    pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
        local purchaseBait = Net:WaitForChild("RF/PurchaseBait")
        if purchaseBait then
            purchaseBait:InvokeServer(baitId)
        end
    end)
end

-- Helper function to format money with commas
local function formatMoney(amount)
    local formatted = tostring(amount)
    while true do
        formatted, k = string.gsub(formatted, "^(-?%d+)(%d%d%d)", '%1,%2')
        if k == 0 then break end
    end
    return formatted
end

-- Smart Farm Toggle
local smartFarmToggle = smartLeft:AddToggle({
    Name = "Enable Smart Farm",
    Default = false,
    Flag = "smart_farm_enabled",
    Callback = function(state)
        getgenv().SmartFarmEnabled = state
        if state then
            task.spawn(function()
                while getgenv().SmartFarmEnabled do
                    pcall(function()
                        -- Get current money
                        currentMoney = getPlayerMoney()
                        
                        -- Get current equipment
                        local currentRodId = getgenv().CurrentRodId or 1
                        local currentBaitId = getgenv().CurrentBaitId or nil
                        
                        -- Find best affordable upgrade
                        local bestRodId, bestBaitId, bestScore, bestCost = findBestCombination(currentMoney, currentRodId, currentBaitId)
                        
                        -- Execute purchases if better options found
                        if bestRodId ~= currentRodId or bestBaitId ~= currentBaitId then
                            if bestRodId ~= currentRodId then
                                purchaseRod(bestRodId)
                                getgenv().CurrentRodId = bestRodId
                            end
                            
                            if bestBaitId ~= currentBaitId then
                                purchaseBait(bestBaitId)
                                getgenv().CurrentBaitId = bestBaitId
                            end
                        else
                            -- No affordable upgrades, check for future upgrades to save for
                            local futureRodId, futureBaitId, futureCost, timeToSave = findBestFutureUpgrade(currentMoney, currentRodId, currentBaitId)
                            if futureCost > currentMoney and timeToSave < math.huge then
                                targetMoney = futureCost
                                savingFor = string.format("%s + %s", RodDatabase[futureRodId].Name, BaitDatabase[futureBaitId].Name)
                            else
                                targetMoney = 0
                                savingFor = ""
                            end
                        end
                        
                        -- Update status display
                        local rodName = currentRodId and RodDatabase[currentRodId].Name or "None"
                        local baitName = currentBaitId and BaitDatabase[currentBaitId].Name or "None"
                        local statusText = string.format("Status: Active\nMoney: â‚¿%s\nTarget: â‚¿%s (%s)\nCurrent Rod: %s\nCurrent Bait: %s", 
                            formatMoney(currentMoney), 
                            formatMoney(targetMoney),
                            savingFor ~= "" and savingFor or "N/A",
                            rodName,
                            baitName)
                        currentStatus:SetContent(statusText)
                    end)
                    task.wait(10) -- Check every 10 seconds
                end
            end)
        else
            -- Update status when disabled
            currentStatus:SetContent("Status: Stopped\nMoney: N/A\nCurrent Rod: N/A\nCurrent Bait: N/A")
        end
    end
})

-- Economy Statistics
smartRight:AddParagraph({
    Title = "Economy Stats",
    Content = "Profit/Hour: 0\nTotal Caught: 0\nAvg. Fish Value: 0"
})

-- Optimization Level Settings
smartRight:AddDropdown({
    Name = "Optimization Level",
    Values = {"Off", "Light", "Medium", "Heavy"},
    Default = "Medium",
    Flag = "optimization_level",
    Callback = function(level)
        getgenv().OptimizationLevel = level
    end
})

-- Apply Optimization Button
smartRight:AddButton({
    Name = "Apply Optimization",
    Callback = function()
        local level = getgenv().OptimizationLevel or "Medium"
        
        if level == "Off" then
            -- Restore original settings
            if getgenv().OriginalLightingSettings then
                local original = getgenv().OriginalLightingSettings
                game.Lighting.GlobalShadows = original.GlobalShadows
                game.Lighting.FogEnd = original.FogEnd
                game.Lighting.ShadowSoftness = original.ShadowSoftness
                game.Lighting.Brightness = original.Brightness
                game.Lighting.Ambient = original.Ambient
                game.Lighting.OutdoorAmbient = original.OutdoorAmbient
                game.Lighting.ExposureCompensation = original.ExposureCompensation
            end
            
            -- Re-enable particle effects
            for _, obj in ipairs(workspace:GetDescendants()) do
                if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") then
                    obj.Enabled = true
                end
            end
            
            Window:AddNotification({
                Title = "Optimization",
                Content = "Optimization disabled. Restored original settings.",
                Duration = 3
            })
            return
        end
        
        -- Save original settings
        if not getgenv().OriginalLightingSettings then
            getgenv().OriginalLightingSettings = {
                GlobalShadows = game.Lighting.GlobalShadows,
                FogEnd = game.Lighting.FogEnd,
                ShadowSoftness = game.Lighting.ShadowSoftness,
                Brightness = game.Lighting.Brightness,
                Ambient = game.Lighting.Ambient,
                OutdoorAmbient = game.Lighting.OutdoorAmbient,
                ExposureCompensation = game.Lighting.ExposureCompensation
            }
        end
        
        -- Apply optimization based on level
        if level == "Light" then
            -- Minimal optimization
            game.Lighting.GlobalShadows = false
            game.Lighting.FogEnd = 1000
            game.Lighting.ShadowSoftness = 0.5
            game.Lighting.Brightness = 1
            game.Lighting.Ambient = Color3.new(0.2, 0.2, 0.2)
            game.Lighting.OutdoorAmbient = Color3.new(0.3, 0.3, 0.3)
            game.Lighting.ExposureCompensation = 0
            
        elseif level == "Medium" then
            -- Balanced optimization
            game.Lighting.GlobalShadows = false
            game.Lighting.FogEnd = 500
            game.Lighting.ShadowSoftness = 0
            game.Lighting.Brightness = 0.9
            game.Lighting.Ambient = Color3.new(0.1, 0.1, 0.1)
            game.Lighting.OutdoorAmbient = Color3.new(0.2, 0.2, 0.2)
            game.Lighting.ExposureCompensation = -0.1
            
        elseif level == "Heavy" then
            -- Maximum optimization
            game.Lighting.GlobalShadows = false
            game.Lighting.FogEnd = 200
            game.Lighting.ShadowSoftness = 0
            game.Lighting.Brightness = 0.7
            game.Lighting.Ambient = Color3.new(0, 0, 0)
            game.Lighting.OutdoorAmbient = Color3.new(0.1, 0.1, 0.1)
            game.Lighting.ExposureCompensation = -0.2
        end
        
        -- Disable only non-essential particles
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") then
                -- Only disable if not essential for gameplay
                if not obj.Name:match("Essential") and not obj.Name:match("Critical") and not obj.Name:match("Important") then
                    obj.Enabled = false
                end
            end
        end
        
        Window:AddNotification({
            Title = "Optimization",
            Content = level .. " optimization applied successfully!",
            Duration = 3
        })
    end
})

-- Automation Tab Sections
local autoLeft = Auto:DrawSection({
    Name = "Quests",
    Position = "left"
})

local autoRight = Auto:DrawSection({
    Name = "Events",
    Position = "right"
})

-- Deep Sea Quest Automation
autoLeft:AddToggle({
    Name = "Deep Sea Quest Automation",
    Default = false,
    Flag = "deep_sea_quest_auto",
    Callback = function(state)
        getgenv().DeepSeaQuestAuto = state
        if state then
            task.spawn(function()
                while getgenv().DeepSeaQuestAuto do
                    pcall(function()
                        local board = workspace:FindFirstChild("!!! MENU RINGS")
                        if board then
                            board = board:FindFirstChild("Deep Sea Tracker")
                            if board then
                                board = board:FindFirstChild("Board")
                                if board then
                                    local label = board:FindFirstChild("Gui")
                                    if label then
                                        label = label:FindFirstChild("Content")
                                        if label then
                                            label = label:FindFirstChild("Label1")
                                            if label then
                                                local text = label.Text
                                                local percent = tonumber(text:match("(%d+)%%"))
                                                
                                                if percent and percent < 100 then
                                                    -- Teleport to incomplete quest location
                                                    local posNotComplete = CFrame.new(-3563.65063, -279.074219, -1605.75671)
                                                    local player = game.Players.LocalPlayer
                                                    local char = player.Character
                                                    if char and char:FindFirstChild("HumanoidRootPart") then
                                                        char.HumanoidRootPart.CFrame = posNotComplete
                                                        -- Apply freeze safely
                                                        local bv = Instance.new("BodyVelocity")
                                                        bv.Velocity = Vector3.new(0, 0, 0)
                                                        bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
                                                        bv.Parent = char.HumanoidRootPart
                                                        
                                                        local bg = Instance.new("BodyGyro")
                                                        bg.CFrame = char.HumanoidRootPart.CFrame
                                                        bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
                                                        bg.Parent = char.HumanoidRootPart
                                                    end
                                                elseif percent and percent >= 100 then
                                                    -- Teleport to complete quest location
                                                    local posComplete = CFrame.new(-3698.01001, -135.073914, -1010.34033)
                                                    local player = game.Players.LocalPlayer
                                                    local char = player.Character
                                                    if char and char:FindFirstChild("HumanoidRootPart") then
                                                        char.HumanoidRootPart.CFrame = posComplete
                                                        -- Apply freeze safely
                                                        local bv = Instance.new("BodyVelocity")
                                                        bv.Velocity = Vector3.new(0, 0, 0)
                                                        bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
                                                        bv.Parent = char.HumanoidRootPart
                                                        
                                                        local bg = Instance.new("BodyGyro")
                                                        bg.CFrame = char.HumanoidRootPart.CFrame
                                                        bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
                                                        bg.Parent = char.HumanoidRootPart
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end)
                    task.wait(5)
                end
            end)
        else
            -- Cleanup freeze objects
            pcall(function()
                local player = game.Players.LocalPlayer
                if player.Character then
                    for _, obj in ipairs(player.Character:GetDescendants()) do
                        if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                            obj:Destroy()
                        end
                    end
                end
            end)
        end
    end
})

-- Aura Boat Quest Automation
autoLeft:AddToggle({
    Name = "Aura Boat Quest Automation",
    Default = false,
    Flag = "aura_boat_quest_auto",
    Callback = function(state)
        getgenv().AuraBoatQuestAuto = state
        if state then
            task.spawn(function()
                while getgenv().AuraBoatQuestAuto do
                    pcall(function()
                        local player = game.Players.LocalPlayer
                        local char = player.Character or player.CharacterAdded:Wait()
                        local hrp = char:WaitForChild("HumanoidRootPart")
                        local overhead = hrp:WaitForChild("Overhead")
                        local levelLabel = overhead:WaitForChild("LevelContainer"):WaitForChild("Label")
                        
                        local text = levelLabel.Text
                        local level = tonumber(text:match("%d+")) or 0
                        
                        if level >= 200 then
                            -- Activate quest
                            local args = {"AuraQuest"}
                            local ReplicatedStorage = game:GetService("ReplicatedStorage")
                            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                            local activateQuest = Net:WaitForChild("RF/ActivateQuestLine")
                            if activateQuest then
                                activateQuest:InvokeServer(unpack(args))
                            end
                            
                            -- Teleport to quest location
                            local targetCFrame = CFrame.new(88.2434769, 9.53157043, 2685.2605)
                            hrp.CFrame = targetCFrame
                            
                            -- Apply freeze safely
                            local bv = Instance.new("BodyVelocity")
                            bv.Velocity = Vector3.new(0, 0, 0)
                            bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
                            bv.Parent = hrp
                            
                            local bg = Instance.new("BodyGyro")
                            bg.CFrame = targetCFrame
                            bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
                            bg.Parent = hrp
                        end
                    end)
                    task.wait(5)
                end
            end)
        else
            -- Cleanup freeze objects
            pcall(function()
                local player = game.Players.LocalPlayer
                if player.Character then
                    for _, obj in ipairs(player.Character:GetDescendants()) do
                        if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                            obj:Destroy()
                        end
                    end
                end
            end)
        end
    end
})

-- Event Automation
autoRight:AddToggle({
    Name = "Event Automation",
    Default = false,
    Flag = "event_automation",
    Callback = function(state)
        getgenv().EventAutomation = state
        if state then
            task.spawn(function()
                while getgenv().EventAutomation do
                    pcall(function()
                        local menuRings = workspace:FindFirstChild("!!! MENU RINGS")
                        if menuRings then
                            local propsFolder = menuRings:FindFirstChild("Props 1") or menuRings:FindFirstChild("Props 2")
                            if propsFolder then
                                local eventObject = propsFolder:FindFirstChild("Shark Hunt") or propsFolder:FindFirstChild("Model")
                                if eventObject then
                                    local player = game.Players.LocalPlayer
                                    local char = player.Character
                                    local hrp = char and char:FindFirstChild("HumanoidRootPart")
                                    
                                    if hrp then
                                        -- Teleport with proper offset
                                        local offset = Vector3.new(0, 10, 0)
                                        hrp.CFrame = eventObject:GetPivot() + offset
                                        
                                        -- Apply freeze safely
                                        local bv = Instance.new("BodyVelocity")
                                        bv.Velocity = Vector3.new(0, 0, 0)
                                        bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
                                        bv.Parent = hrp
                                        
                                        local bg = Instance.new("BodyGyro")
                                        bg.CFrame = hrp.CFrame
                                        bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
                                        bg.Parent = hrp
                                    end
                                end
                            end
                        end
                    end)
                    task.wait(1)
                end
            end)
        else
            -- Cleanup freeze objects
            pcall(function()
                local player = game.Players.LocalPlayer
                if player.Character then
                    for _, obj in ipairs(player.Character:GetDescendants()) do
                        if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                            obj:Destroy()
                        end
                    end
                end
            end)
        end
    end
})

-- Shop Tab Sections
local shopLeft = Shop:DrawSection({
    Name = "Equipment",
    Position = "left"
})

local shopRight = Shop:DrawSection({
    Name = "Items",
    Position = "right"
})

-- Rod Purchase System
shopLeft:AddDropdown({
    Name = "Premium Fishing Rods",
    Values = {
        "Carbon Fiber Rod - 900 coins",
        "Grass Master Rod - 1.5k coins",
        "Demascus Elite Rod - 3k coins",
        "Ice Frost Rod - 5k coins",
        "Lucky Charm Rod - 15k coins",
        "Midnight Shadow Rod - 50k coins",
        "Steampunk Precision Rod - 215k coins",
        "Astral Galaxy Rod - 1M coins"
    },
    Default = "Carbon Fiber Rod - 900 coins",
    Flag = "selected_rod",
    Callback = function(value)
        getgenv().SelectedRod = value
    end
})

shopLeft:AddButton({
    Name = "Purchase Selected Rod",
    Callback = function()
        pcall(function()
            local rodMap = {
                ["Carbon Fiber Rod - 900 coins"] = 76,
                ["Grass Master Rod - 1.5k coins"] = 85,
                ["Demascus Elite Rod - 3k coins"] = 77,
                ["Ice Frost Rod - 5k coins"] = 78,
                ["Lucky Charm Rod - 15k coins"] = 79,
                ["Midnight Shadow Rod - 50k coins"] = 80,
                ["Steampunk Precision Rod - 215k coins"] = 6,
                ["Astral Galaxy Rod - 1M coins"] = 5
            }
            
            local rodName = getgenv().SelectedRod or "Carbon Fiber Rod - 900 coins"
            local rodId = rodMap[rodName]
            
            if rodId then
                purchaseRod(rodId)
                Window:AddNotification({
                    Title = "Success",
                    Content = "Rod purchased successfully!",
                    Duration = 3
                })
            end
        end)
    end
})

-- Bait Purchase System
shopRight:AddDropdown({
    Name = "Advanced Baits",
    Values = {
        "Topwater Elite Bait - 100 coins",
        "Luck Enhancement Bait - 1k coins",
        "Midnight Shadow Bait - 3k coins",
        "Chroma Spectrum Bait - 290k coins",
        "Dark Matter Bait - 630k coins",
        "Corrupt Dimension Bait - 1.15M coins",
        "Aether Cosmic Bait - 3.70M coins"
    },
    Default = "Topwater Elite Bait - 100 coins",
    Flag = "selected_bait",
    Callback = function(value)
        getgenv().SelectedBait = value
    end
})

shopRight:AddButton({
    Name = "Purchase Selected Bait",
    Callback = function()
        pcall(function()
            local baitMap = {
                ["Topwater Elite Bait - 100 coins"] = 10,
                ["Luck Enhancement Bait - 1k coins"] = 2,
                ["Midnight Shadow Bait - 3k coins"] = 3,
                ["Chroma Spectrum Bait - 290k coins"] = 6,
                ["Dark Matter Bait - 630k coins"] = 8,
                ["Corrupt Dimension Bait - 1.15M coins"] = 15,
                ["Aether Cosmic Bait - 3.70M coins"] = 16
            }
            
            local baitName = getgenv().SelectedBait or "Topwater Elite Bait - 100 coins"
            local baitId = baitMap[baitName]
            
            if baitId then
                purchaseBait(baitId)
                Window:AddNotification({
                    Title = "Success",
                    Content = "Bait purchased successfully!",
                    Duration = 3
                })
            end
        end)
    end
})

-- Boats Tab Sections
local boatLeft = Boat:DrawSection({
    Name = "Purchase",
    Position = "left"
})

local boatRight = Boat:DrawSection({
    Name = "Management",
    Position = "right"
})

-- Boat Purchase System
boatLeft:AddDropdown({
    Name = "Premium Boats",
    Values = {
        "Fishing Kayak - 1.1k coins",
        "High-Speed Jetski - 7.5k coins",
        "Highfield Explorer - 25k coins",
        "Speed Demon Boat - 70k coins",
        "Professional Fishing Boat - 180k coins",
        "Luxury Mini Yacht - 1.2M coins",
        "Hyper Velocity Boat - 999 Robux"
    },
    Default = "Fishing Kayak - 1.1k coins",
    Flag = "purchase_boat",
    Callback = function(value)
        getgenv().PurchaseBoat = value
    end
})

boatLeft:AddButton({
    Name = "Purchase Boat",
    Callback = function()
        pcall(function()
            local boatMap = {
                ["Fishing Kayak - 1.1k coins"] = 2,
                ["High-Speed Jetski - 7.5k coins"] = 3,
                ["Highfield Explorer - 25k coins"] = 4,
                ["Speed Demon Boat - 70k coins"] = 5,
                ["Professional Fishing Boat - 180k coins"] = 6,
                ["Luxury Mini Yacht - 1.2M coins"] = 14,
                ["Hyper Velocity Boat - 999 Robux"] = 7
            }
            
            local boatName = getgenv().PurchaseBoat or "Fishing Kayak - 1.1k coins"
            local boatId = boatMap[boatName]
            
            if boatId then
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                local purchaseBoat = Net:WaitForChild("RF/PurchaseBoat")
                
                if purchaseBoat then
                    purchaseBoat:InvokeServer(boatId)
                    Window:AddNotification({
                        Title = "Success",
                        Content = "Boat purchased successfully!",
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- Boat Spawn System
boatRight:AddDropdown({
    Name = "Available Boats",
    Values = {
        "Fishing Kayak",
        "High-Speed Jetski",
        "Highfield Explorer",
        "Speed Demon Boat",
        "Professional Fishing Boat",
        "Luxury Mini Yacht",
        "Hyper Velocity Boat",
        "Dinky Fishing Boat",
        "Aura Spirit Boat",
        "Burger King Boat",
        "Mega Hovercraft",
        "Froen Ice Boat",
        "Cruiser Luxury Boat",
        "Rubber Ducky"
    },
    Default = "Fishing Kayak",
    Flag = "spawn_boat",
    Callback = function(value)
        getgenv().SpawnBoat = value
    end
})

boatRight:AddButton({
    Name = "Spawn Selected Boat",
    Callback = function()
        pcall(function()
            local boatMap = {
                ["Fishing Kayak"] = 2,
                ["High-Speed Jetski"] = 3,
                ["Highfield Explorer"] = 4,
                ["Speed Demon Boat"] = 5,
                ["Professional Fishing Boat"] = 6,
                ["Luxury Mini Yacht"] = 14,
                ["Hyper Velocity Boat"] = 7,
                ["Dinky Fishing Boat"] = 20,
                ["Aura Spirit Boat"] = 17,
                ["Burger King Boat"] = 18,
                ["Mega Hovercraft"] = 19,
                ["Froen Ice Boat"] = 11,
                ["Cruiser Luxury Boat"] = 13,
                ["Rubber Ducky"] = 16
            }
            
            local boatName = getgenv().SpawnBoat or "Fishing Kayak"
            local boatId = boatMap[boatName]
            
            if boatId then
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                local spawnBoat = Net:WaitForChild("RF/SpawnBoat")
                
                if spawnBoat then
                    spawnBoat:InvokeServer(boatId)
                    Window:AddNotification({
                        Title = "Success",
                        Content = "Boat spawned successfully!",
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- Player Tab Sections
local playerLeft = Player:DrawSection({
    Name = "Enhancements",
    Position = "left"
})

local playerRight = Player:DrawSection({
    Name = "Performance",
    Position = "right"
})

-- Player Enhancements
playerLeft:AddToggle({
    Name = "Oxygen Bypass",
    Default = false,
    Flag = "oxygen_bypass",
    Callback = function(state)
        pcall(function()
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            
            if state then
                local equipOxygen = Net:WaitForChild("RF/EquipOxygenTank")
                if equipOxygen then
                    equipOxygen:InvokeServer(105)
                end
            else
                local unequipOxygen = Net:WaitForChild("RF/UnequipOxygenTank")
                if unequipOxygen then
                    unequipOxygen:InvokeServer()
                end
            end
        end)
    end
})

playerLeft:AddToggle({
    Name = "Advanced Fish Radar",
    Default = false,
    Flag = "fish_radar",
    Callback = function(state)
        pcall(function()
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            local updateRadar = Net:WaitForChild("RF/UpdateFishingRadar")
            
            if updateRadar then
                updateRadar:InvokeServer(state)
            end
        end)
    end
})

-- Navigation Tab Sections
local teleportLeft = Teleport:DrawSection({
    Name = "Islands",
    Position = "left"
})

local teleportRight = Teleport:DrawSection({
    Name = "NPCs",
    Position = "right"
})

-- Island Navigation
teleportLeft:AddDropdown({
    Name = "Island Destinations",
    Values = {
        "Kohana Main Island",
        "Winter Festival Zone",
        "Lost Ancient Isle",
        "Esoteric Mystical Island",
        "Volcanic Crater Island",
        "Coral Reef Paradise",
        "Kohana Volcano Summit",
        "Fisherman's Haven",
        "Esoteric Depths",
        "Tropical Grove",
        "Treasure Vault",
        "Weather Control Station",
        "Sisyphus Monument"
    },
    Default = "Kohana Main Island",
    Flag = "selected_island",
    Callback = function(value)
        getgenv().SelectedIsland = value
    end
})

teleportLeft:AddButton({
    Name = "Teleport Now",
    Callback = function()
        pcall(function()
            local islandMap = {
                ["Kohana Main Island"] = CFrame.new(-642.243561, 16.0354481, 624.918884),
                ["Winter Festival Zone"] = CFrame.new(1687.93079, 6.8625145, 3309.67725),
                ["Lost Ancient Isle"] = CFrame.new(-3660.07031, 26.1918774, -933.131897),
                ["Esoteric Mystical Island"] = CFrame.new(2029.47913, 27.3972206, 1393.52319),
                ["Volcanic Crater Island"] = CFrame.new(973.268372, 7.36203814, 4879.09277),
                ["Coral Reef Paradise"] = CFrame.new(-3134.98511, 20.9564934, 2167.80566),
                ["Kohana Volcano Summit"] = CFrame.new(-525.122925, 24.0000591, 187.470749),
                ["Fisherman's Haven"] = CFrame.new(33.5687256, 17.0335217, 2834.95557),
                ["Esoteric Depths"] = CFrame.new(3152.74707, -1302.72986, 1438.05444),
                ["Tropical Grove"] = CFrame.new(-2046.1554, 6.26801682, 3660.56006),
                ["Treasure Vault"] = CFrame.new(-3599.53491, -266.57373, -1566.98657),
                ["Weather Control Station"] = CFrame.new(-1525.72632, 6.49999952, 1892.23645),
                ["Sisyphus Monument"] = CFrame.new(-3692.22021, -135.574417, -1026.96167)
            }
            
            local islandName = getgenv().SelectedIsland or "Kohana Main Island"
            local islandCFrame = islandMap[islandName]
            
            if islandCFrame then
                local player = game.Players.LocalPlayer
                local char = player.Character or player.CharacterAdded:Wait()
                local hrp = char:FindFirstChild("HumanoidRootPart")
                
                if hrp then
                    -- Smooth teleport with fade effect
                    local currentPos = hrp.Position
                    local distance = (islandCFrame.Position - currentPos).Magnitude
                    local teleportTime = math.clamp(distance / 100, 0.2, 1.0)
                    
                    for i = 0, 1, 0.1 do
                        hrp.CFrame = CFrame.new(currentPos:Lerp(islandCFrame.Position, i), islandCFrame.LookVector)
                        task.wait(teleportTime * 0.1)
                    end
                    
                    Window:AddNotification({
                        Title = "Teleported",
                        Content = "Successfully teleported to " .. islandName,
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- NPC Navigation
teleportRight:AddDropdown({
    Name = "NPC Locations",
    Values = {
        "Captain Jones - General Store",
        "McBoatson - Boat Shop",
        "Tim - Fishing Supplies",
        "Dr. Science - Research Lab",
        "Lava Fisher - Volcano Summit"
    },
    Default = "Captain Jones - General Store",
    Flag = "selected_npc",
    Callback = function(value)
        getgenv().SelectedNPC = value
    end
})

teleportRight:AddButton({
    Name = "Find NPC",
    Callback = function()
        pcall(function()
            local npcMap = {
                ["Captain Jones - General Store"] = CFrame.new(-678.315857, 16.4103374, 595.322937),
                ["McBoatson - Boat Shop"] = CFrame.new(-627.383911, 3.04580736, 719.454956),
                ["Tim - Fishing Supplies"] = CFrame.new(-595.170044, 16.3734112, 608.429932),
                ["Dr. Science - Research Lab"] = CFrame.new(-7.82026434, 14.6700287, 2885.70532),
                ["Lava Fisher - Volcano Summit"] = CFrame.new(-595.716797, 59.000061, 135.618927)
            }
            
            local npcName = getgenv().SelectedNPC or "Captain Jones - General Store"
            local npcCFrame = npcMap[npcName]
            
            if npcCFrame then
                local player = game.Players.LocalPlayer
                local char = player.Character or player.CharacterAdded:Wait()
                local hrp = char:FindFirstChild("HumanoidRootPart")
                
                if hrp then
                    -- Smooth teleport
                    local currentPos = hrp.Position
                    local distance = (npcCFrame.Position - currentPos).Magnitude
                    local teleportTime = math.clamp(distance / 100, 0.2, 1.0)
                    
                    for i = 0, 1, 0.1 do
                        hrp.CFrame = CFrame.new(currentPos:Lerp(npcCFrame.Position, i), npcCFrame.LookVector)
                        task.wait(teleportTime * 0.1)
                    end
                    
                    Window:AddNotification({
                        Title = "Teleported",
                        Content = "Successfully teleported to " .. npcName,
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- Server Tab Sections
local serverLeft = Server:DrawSection({
    Name = "Management",
    Position = "left"
})

local serverRight = Server:DrawSection({
    Name = "Utilities",
    Position = "right"
})

-- Server Management
serverLeft:AddToggle({
    Name = "Auto Rejoin Protection",
    Default = false,
    Flag = "auto_rejoin",
    Callback = function(state)
        getgenv().AutoRejoin = state
        if state then
            task.spawn(function()
                while getgenv().AutoRejoin do
                    pcall(function()
                        if not game.Players.LocalPlayer.Character then
                            local TeleportService = game:GetService("TeleportService")
                            TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, game.Players.LocalPlayer)
                        end
                    end)
                    task.wait(5)
                end
            end)
        end
    end
})

-- Server Utilities
serverRight:AddButton({
    Name = "Server Hop",
    Callback = function()
        pcall(function()
            local TeleportService = game:GetService("TeleportService")
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local HttpService = game:GetService("HttpService")
            
            local url = ("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Asc&limit=100"):format(game.PlaceId)
            local response = game:HttpGet(url)
            local servers = HttpService:JSONDecode(response)
            
            for _, server in ipairs(servers.data) do
                if server.playing < server.maxPlayers and server.id ~= game.JobId then
                    TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, LocalPlayer)
                    return
                end
            end
            
            Window:AddNotification({
                Title = "Error",
                Content = "No available servers found!",
                Duration = 3
            })
        end)
    end
})

serverRight:AddButton({
    Name = "Copy Server ID",
    Callback = function()
        setclipboard(game.JobId)
        Window:AddNotification({
            Title = "Copied!",
            Content = "Server ID copied to clipboard",
            Duration = 3
        })
    end
})

-- Config Manager
local Configs = Window:DrawConfig({
    Name = "Configuration",
    Icon = "folder",
    Config = FileWatcher
})

Configs:Init()

-- Status Tracking with Performance Monitoring
local function updateStatus()
    pcall(function()
        local statusSection = Home:DrawSection({
            Name = "System Status",
            Position = "left"
        })
        
        local RunService = game:GetService("RunService")
        local Stats = game:GetService("Stats")
        
        local fps = 0
        local ping = 0
        local timePlayed = 0
        local joinTime = os.time()
        
        RunService.Heartbeat:Connect(function()
            fps = math.floor(1 / RunService.Heartbeat:Wait())
            ping = Stats.Network.ServerStatsItem["Data Ping"]:GetValue()
            timePlayed = os.time() - joinTime
            
            local hours = math.floor(timePlayed / 3600)
            local minutes = math.floor((timePlayed % 3600) / 60)
            local seconds = timePlayed % 60
            
            local timeFormatted = string.format("%02d:%02d:%02d", hours, minutes, seconds)
            
            statusSection:AddParagraph({
                Title = "Performance Monitor",
                Content = "FPS: " .. fps .. "\nPing: " .. math.floor(ping) .. " ms\nTime: " .. timeFormatted
            })
        end)
    end)
end

task.spawn(updateStatus)

-- Initialize global variables
getgenv().AdvancedFishing = false
getgenv().AutoSellItems = false
getgenv().SmartFarmEnabled = false
getgenv().DeepSeaQuestAuto = false
getgenv().AuraBoatQuestAuto = false
getgenv().EventAutomation = false
getgenv().AutoEquipBestRod = false
getgenv().AutoRejoin = false
getgenv().CurrentRodId = 1
getgenv().CurrentBaitId = nil
getgenv().SelectedRod = "Carbon Fiber Rod - 900 coins"
getgenv().SelectedBait = "Topwater Elite Bait - 100 coins"
getgenv().PurchaseBoat = "Fishing Kayak - 1.1k coins"
getgenv().SpawnBoat = "Fishing Kayak"
getgenv().SelectedIsland = "Kohana Main Island"
getgenv().SelectedNPC = "Captain Jones - General Store"
getgenv().SellInterval = 3
getgenv().OptimizationLevel = "Medium"

-- Cleanup on character removal - Comprehensive cleanup
game:GetService("Players").LocalPlayer.CharacterRemoving:Connect(function()
    -- Disable all features
    getgenv().AdvancedFishing = false
    getgenv().AutoSellItems = false
    getgenv().SmartFarmEnabled = false
    getgenv().DeepSeaQuestAuto = false
    getgenv().AuraBoatQuestAuto = false
    getgenv().EventAutomation = false
    getgenv().AutoEquipBestRod = false
    getgenv().AutoRejoin = false
    
    -- Remove all physics objects
    pcall(function()
        local player = game.Players.LocalPlayer
        if player.Character then
            for _, obj in ipairs(player.Character:GetDescendants()) do
                if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") or obj:IsA("BodyForce") then
                    obj:Destroy()
                end
            end
        end
    end)
    
    -- Restore lighting settings if they were changed
    pcall(function()
        local original = getgenv().OriginalLightingSettings
        if original then
            game.Lighting.GlobalShadows = original.GlobalShadows
            game.Lighting.FogEnd = original.FogEnd
            game.Lighting.ShadowSoftness = original.ShadowSoftness
            game.Lighting.Brightness = original.Brightness
            game.Lighting.Ambient = original.Ambient
            game.Lighting.OutdoorAmbient = original.OutdoorAmbient
            game.Lighting.ExposureCompensation = original.ExposureCompensation
        end
    end)
    
    -- Re-enable essential particle effects
    pcall(function()
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") then
                if obj.Name:match("Essential") or obj.Name:match("Critical") then
                    obj.Enabled = true
                end
            end
        end
    end)
end)

-- Anti-ban protection system
task.spawn(function()
    while true do
        task.wait(60) -- Check every minute
        
        pcall(function()
            local player = game.Players.LocalPlayer
            
            -- Random movement to avoid detection
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and not getgenv().AdvancedFishing then
                local hrp = player.Character.HumanoidRootPart
                local originalPos = hrp.Position
                
                -- Small random movements
                for _ = 1, 3 do
                    local randomOffset = Vector3.new(
                        math.random() - 0.5,
                        0,
                        math.random() - 0.5
                    ) * 2
                    hrp.CFrame = CFrame.new(originalPos + randomOffset, originalPos)
                    task.wait(0.1)
                end
                
                hrp.CFrame = CFrame.new(originalPos, originalPos + Vector3.new(1, 0, 0))
            end
            
            -- Random pauses in auto fishing
            if getgenv().AdvancedFishing and math.random() < 0.1 then
                local wasFishing = getgenv().AdvancedFishing
                getgenv().AdvancedFishing = false
                task.wait(math.random(3, 8))
                getgenv().AdvancedFishing = wasFishing
            end
        end)
    end
end)

Window:AddNotification({
    Title = "Loaded",
    Content = "Souls Hub Pro v2.1.0 loaded successfully!\nAll major bugs fixed and performance optimized!",
    Duration = 6
})

Window:Draw()
