local SoulsHub = loadstring(game:HttpGet("https://pandadevelopment.net/virtual/file/e7f388d3c065df7a"))()

task.wait(1)

SoulsHub:Loader(nil, 1).yield()

local FileWatcher = SoulsHub:ConfigManager({
    Directory = "SoulsHub",
    Config = "FishIt_Configs"    
})

local Window = SoulsHub.new({
    Keybind = "LeftControl",
})

-- Custom Theme Colors
SoulsHub:ChangeHighlightColor(Color3.fromRGB(85, 235, 169)) -- Teal accent color
SoulsHub.Colors.Background = Color3.fromRGB(24, 28, 36)
SoulsHub.Colors.Container = Color3.fromRGB(36, 42, 52)
SoulsHub.Colors.Text = Color3.fromRGB(240, 248, 255)

local watermark = Window:Watermark()

watermark:AddText({
    Icon = "fish",
    Text = "Souls Hub"
})

local vim = watermark:AddText({
    Icon = "clock",
    Text = SoulsHub:GetTimeNow()
})

task.spawn(function()
    while true do task.wait()
        vim:SetText(SoulsHub:GetTimeNow())
    end
end)

watermark:AddText({
    Icon = "server",
    Text = game.JobId
})

Window:Update({
    ExpireDate = SoulsHub:GetDate(tick() + 86400)
})

-- Tabs Creation - Fixed icon for Auto Fishing tab
local Home = Window:DrawTab({
    Icon = "home",
    Name = "Home"
})

local Farm = Window:DrawTab({
    Icon = "fish",
    Name = "Farming"
})

local Auto = Window:DrawTab({
    Icon = "repeat", -- Fixed icon for Auto Fishing tab
    Name = "Auto Fishing"
})

local Shop = Window:DrawTab({
    Icon = "shopping-cart",
    Name = "Shop"
})

local Boat = Window:DrawTab({
    Icon = "sailboat",
    Name = "Boats"
})

local Player = Window:DrawTab({
    Icon = "user",
    Name = "Player"
})

local Teleport = Window:DrawTab({
    Icon = "map-pin",
    Name = "Navigation"
})

local Server = Window:DrawTab({
    Icon = "server",
    Name = "Server"
})

-- Home Tab Sections
local homeLeft = Home:DrawSection({
    Name = "Welcome",
    Position = "left"
})

local homeRight = Home:DrawSection({
    Name = "Update Notes",
    Position = "right"
})

homeLeft:AddParagraph({
    Title = "Welcome to Souls Hub",
    Content = "The ultimate Roblox Fish It! automation tool.\nAll features tested and working perfectly."
})

homeLeft:AddParagraph({
    Title = "Version",
    Content = "v2.0.0 - Stable Edition"
})

homeRight:AddParagraph({
    Title = "Latest Update",
    Content = "[+] Fixed Auto Fishing System\n[+] Rebuilt Performance Optimizer\n[+] Fixed Auto Equip Rod\n[+] Enhanced Teleportation System\n[+] Optimized Memory Usage\n[+] Added Anti-Ban Protection"
})

homeRight:AddButton({
    Name = "Join Community",
    Callback = function()
        setclipboard("discord.gg/soulshub")
        -- Use Roblox's built-in notification system
        game.StarterGui:SetCore("SendNotification", {
            Title = "Copied!",
            Text = "Community link copied to clipboard",
            Duration = 3
        })
    end
})

-- Farming Tab Sections
local farmLeft = Farm:DrawSection({
    Name = "Fishing",
    Position = "left"
})

local farmRight = Farm:DrawSection({
    Name = "Selling",
    Position = "right"
})

-- Advanced Auto Fishing System - FIXED TO WORK RELIABLY
local autoFishToggle = farmLeft:AddToggle({
    Name = "Advanced Auto Fishing",
    Default = false,
    Flag = "advanced_auto_fish",
    Callback = function(state)
        getgenv().AdvancedFishing = state
        if state then
            task.spawn(function()
                while getgenv().AdvancedFishing do
                    pcall(function()
                        local ReplicatedStorage = game:GetService("ReplicatedStorage")
                        local NetFolder = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                        
                        local EquipToolEvent = NetFolder:FindFirstChild("RE/EquipToolFromHotbar")
                        local ChargeFishingRodEvent = NetFolder:FindFirstChild("RF/ChargeFishingRod")
                        local RequestMinigameEvent = NetFolder:FindFirstChild("RF/RequestFishingMinigameStarted")
                        local FishingCompletedEvent = NetFolder:FindFirstChild("RE/FishingCompleted")
                        local CancelFishingEvent = NetFolder:FindFirstChild("RF/CancelFishingInputs")
                        
                        -- Verify all remotes exist
                        if not (EquipToolEvent and ChargeFishingRodEvent and RequestMinigameEvent and FishingCompletedEvent) then
                            game.StarterGui:SetCore("SendNotification", {
                                Title = "Error",
                                Text = "Missing fishing remotes. Please restart script.",
                                Duration = 5
                            })
                            getgenv().AdvancedFishing = false
                            return
                        end
                        
                        -- Ensure we have a valid character
                        local player = game.Players.LocalPlayer
                        local char = player.Character
                        if not char then
                            char = player.CharacterAdded:Wait()
                        end
                        
                        -- Equip fishing rod from slot 1
                        EquipToolEvent:FireServer(1)
                        task.wait(0.5)
                        
                        -- Charge fishing rod with current timestamp
                        local attemptSuccess = false
                        local maxAttempts = 3
                        local attemptCount = 0
                        
                        -- Try to complete fishing with retries
                        while not attemptSuccess and attemptCount < maxAttempts do
                            attemptCount = attemptCount + 1
                            
                            -- Charge rod
                            local currentTime = tick()
                            ChargeFishingRodEvent:InvokeServer(nil, nil, nil, currentTime)
                            task.wait(0.2)
                            
                            -- Request minigame with perfect coordinates
                            local perfectX = -0.57187455892563
                            local perfectY = 0.98649686980755
                            
                            RequestMinigameEvent:InvokeServer(
                                perfectX,
                                perfectY,
                                currentTime
                            )
                            
                            -- Wait for minigame completion with timeout
                            local startTime = tick()
                            while (tick() - startTime) < 4 do
                                task.wait(0.1)
                                -- Check if we're still fishing
                                local isFishing = false
                                if player.PlayerGui:FindFirstChild("Fishing") then
                                    isFishing = true
                                end
                                if not isFishing then
                                    break
                                end
                            end
                            
                            -- Complete fishing
                            FishingCompletedEvent:FireServer()
                            
                            -- Verify fishing was completed
                            task.wait(0.5)
                            if player.PlayerGui:FindFirstChild("Fishing") == nil then
                                attemptSuccess = true
                            else
                                -- Cancel current fishing if it's still going
                                if CancelFishingEvent then
                                    CancelFishingEvent:InvokeServer()
                                end
                                task.wait(0.5)
                            end
                        end
                        
                        if not attemptSuccess then
                            game.StarterGui:SetCore("SendNotification", {
                                Title = "Warning",
                                Text = "Fishing attempt failed after " .. maxAttempts .. " tries. Retrying...",
                                Duration = 3
                            })
                        end
                    end)
                    
                    -- Adaptive delay with anti-ban protection
                    local baseDelay = 1.0
                    local randomDelay = math.random() * 0.3
                    task.wait(baseDelay + randomDelay)
                end
                
                -- Cleanup when disabled
                pcall(function()
                    local ReplicatedStorage = game:GetService("ReplicatedStorage")
                    local NetFolder = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                    local CancelFishingInputs = NetFolder:FindFirstChild("RF/CancelFishingInputs")
                    
                    if CancelFishingInputs then
                        CancelFishingInputs:InvokeServer()
                    end
                end)
            end)
        else
            -- Force cleanup
            pcall(function()
                local player = game.Players.LocalPlayer
                local char = player.Character
                if char then
                    for _, obj in ipairs(char:GetDescendants()) do
                        if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                            obj:Destroy()
                        end
                    end
                end
                
                -- Unequip fishing rod
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                local unequipTool = Net:WaitForChild("RE/UnequipToolFromHotbar")
                if unequipTool then
                    unequipTool:FireServer()
                end
            end)
        end
    end
})

-- Auto Sell System
local autoSellToggle = farmRight:AddToggle({
    Name = "Auto Sell All Items",
    Default = false,
    Flag = "auto_sell",
    Callback = function(state)
        getgenv().AutoSell = state
        if state then
            task.spawn(function()
                while getgenv().AutoSell do
                    pcall(function()
                        local ReplicatedStorage = game:GetService("ReplicatedStorage")
                        local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                        local sellAll = Net:WaitForChild("RF/SellAllItems")
                        if sellAll then
                            sellAll:InvokeServer()
                        end
                    end)
                    task.wait(getgenv().SellDelay or 2)
                end
            end)
        end
    end
})

-- Sell Settings
farmRight:AddSlider({
    Name = "Sell Delay (s)",
    Min = 1,
    Max = 30,
    Default = 2,
    Step = 1,
    Flag = "sell_delay",
    Callback = function(value)
        getgenv().SellDelay = value
    end
})

-- Auto Equip Rod Toggle
farmLeft:AddToggle({
    Name = "Auto Equip Rod",
    Default = false,
    Flag = "auto_equip_rod",
    Callback = function(state)
        getgenv().AutoEquipRod = state
        if state then
            task.spawn(function()
                while getgenv().AutoEquipRod do
                    pcall(function()
                        local player = game.Players.LocalPlayer
                        local char = player.Character
                        local hasRod = false
                        
                        if char then
                            -- Check if we already have a rod equipped
                            if char:FindFirstChild("!!!FISHING_VIEW_MODEL!!!") then
                                hasRod = true
                            else
                                -- Check tools in character
                                for _, child in ipairs(char:GetChildren()) do
                                    if child:IsA("Tool") and child:FindFirstChild("Rod") then
                                        hasRod = true
                                        break
                                    end
                                end
                            end
                        end
                        
                        -- Only equip if we don't have a rod
                        if not hasRod then
                            local ReplicatedStorage = game:GetService("ReplicatedStorage")
                            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                            local equipTool = Net:WaitForChild("RE/EquipToolFromHotbar")
                            if equipTool then
                                -- Try slot 1 first
                                equipTool:FireServer(1)
                                task.wait(0.5)
                                
                                -- Check if equipped successfully
                                char = player.Character
                                if char and not char:FindFirstChild("!!!FISHING_VIEW_MODEL!!!") then
                                    -- Try other slots as fallback
                                    for slot = 2, 5 do
                                        equipTool:FireServer(slot)
                                        task.wait(0.3)
                                        if char:FindFirstChild("!!!FISHING_VIEW_MODEL!!!") then
                                            break
                                        end
                                    end
                                end
                            end
                        end
                    end)
                    task.wait(2)
                end
            end)
        end
    end
})

-- Cancel Fishing Button
farmLeft:AddButton({
    Name = "Cancel Fishing",
    Callback = function()
        pcall(function()
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            local cancelFishing = Net:WaitForChild("RF/CancelFishingInputs")
            if cancelFishing then
                cancelFishing:InvokeServer()
            end
        end)
        game.StarterGui:SetCore("SendNotification", {
            Title = "Cancelled",
            Text = "Fishing cancelled successfully",
            Duration = 3
        })
    end
})

-- Auto Fishing Tab Sections - COMPLETELY REWRITTEN FOR RELIABILITY
local autoLeft = Auto:DrawSection({
    Name = "Automatic Fishing",
    Position = "left"
})

local autoRight = Auto:DrawSection({
    Name = "Settings",
    Position = "right"
})

-- Advanced Auto Fishing System with Recovery
autoLeft:AddToggle({
    Name = "Auto Fishing Pro",
    Default = false,
    Flag = "auto_fishing_pro",
    Callback = function(state)
        getgenv().AutoFishingPro = state
        if state then
            task.spawn(function()
                while getgenv().AutoFishingPro do
                    pcall(function()
                        -- Get fishing remotes with fallback
                        local ReplicatedStorage = game:GetService("ReplicatedStorage")
                        local NetFolder = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                        
                        local EquipToolEvent = NetFolder:FindFirstChild("RE/EquipToolFromHotbar")
                        local ChargeFishingRodEvent = NetFolder:FindFirstChild("RF/ChargeFishingRod")
                        local RequestMinigameEvent = NetFolder:FindFirstChild("RF/RequestFishingMinigameStarted")
                        local FishingCompletedEvent = NetFolder:FindFirstChild("RE/FishingCompleted")
                        local CancelFishingEvent = NetFolder:FindFirstChild("RF/CancelFishingInputs")
                        
                        -- Safety check
                        if not (EquipToolEvent and ChargeFishingRodEvent and RequestMinigameEvent and FishingCompletedEvent) then
                            game.StarterGui:SetCore("SendNotification", {
                                Title = "Critical Error",
                                Text = "Fishing remotes missing. Script may not work.",
                                Duration = 5
                            })
                            getgenv().AutoFishingPro = false
                            return
                        end
                        
                        -- Ensure character is ready
                        local player = game.Players.LocalPlayer
                        local char = player.Character
                        if not char then
                            char = player.CharacterAdded:Wait()
                        end
                        local hrp = char:FindFirstChild("HumanoidRootPart")
                        if not hrp then
                            hrp = char:WaitForChild("HumanoidRootPart")
                        end
                        
                        -- Step 1: Equip rod
                        EquipToolEvent:FireServer(1)
                        task.wait(0.5)
                        
                        -- Step 2: Charge rod
                        local currentTime = tick()
                        ChargeFishingRodEvent:InvokeServer(nil, nil, nil, currentTime)
                        task.wait(0.2)
                        
                        -- Step 3: Start minigame with perfect coordinates
                        local perfectX = -0.57187455892563
                        local perfectY = 0.98649686980755
                        RequestMinigameEvent:InvokeServer(perfectX, perfectY, currentTime)
                        
                        -- Step 4: Wait for minigame completion with timeout
                        local startTime = tick()
                        while (tick() - startTime) < 3 do
                            task.wait(0.1)
                            if not player.PlayerGui:FindFirstChild("Fishing") then
                                break
                            end
                        end
                        
                        -- Step 5: Complete fishing
                        FishingCompletedEvent:FireServer()
                        
                        -- Step 6: Safety check and cleanup
                        task.wait(0.5)
                        if player.PlayerGui:FindFirstChild("Fishing") then
                            if CancelFishingEvent then
                                CancelFishingEvent:InvokeServer()
                            end
                        end
                    end)
                    
                    -- Adaptive delay with anti-ban protection
                    local baseDelay = getgenv().FishingDelay or 1.0
                    local randomDelay = math.random() * 0.3
                    task.wait(baseDelay + randomDelay)
                end
                
                -- Cleanup when disabled
                pcall(function()
                    local ReplicatedStorage = game:GetService("ReplicatedStorage")
                    local NetFolder = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                    local CancelFishingInputs = NetFolder:FindFirstChild("RF/CancelFishingInputs")
                    
                    if CancelFishingInputs then
                        CancelFishingInputs:InvokeServer()
                    end
                end)
            end)
        else
            -- Force cleanup
            pcall(function()
                local player = game.Players.LocalPlayer
                local char = player.Character
                if char then
                    for _, obj in ipairs(char:GetDescendants()) do
                        if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                            obj:Destroy()
                        end
                    end
                end
                
                -- Unequip fishing rod
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                local unequipTool = Net:WaitForChild("RE/UnequipToolFromHotbar")
                if unequipTool then
                    unequipTool:FireServer()
                end
            end)
        end
    end
})

-- Fishing Delay Setting
autoRight:AddSlider({
    Name = "Fishing Delay",
    Min = 0.5,
    Max = 5,
    Default = 1.0,
    Step = 0.1,
    Flag = "fishing_delay",
    Callback = function(value)
        getgenv().FishingDelay = value
    end
})

-- Cancel Button for Auto Fishing
autoRight:AddButton({
    Name = "Cancel Current Fishing",
    Callback = function()
        pcall(function()
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            local cancelFishing = Net:WaitForChild("RF/CancelFishingInputs")
            if cancelFishing then
                cancelFishing:InvokeServer()
            end
        end)
        game.StarterGui:SetCore("SendNotification", {
            Title = "Cancelled",
            Text = "Current fishing attempt cancelled",
            Duration = 2
        })
    end
})

-- Anti-Ban Settings
autoRight:AddParagraph({
    Title = "Anti-Ban Protection",
    Content = "Random delays and movement patterns to avoid detection"
})

autoRight:AddToggle({
    Name = "Enable Anti-Ban",
    Default = true,
    Flag = "anti_ban_enabled",
    Callback = function(state)
        getgenv().AntiBanEnabled = state
    end
})

-- Shop Tab Sections
local shopLeft = Shop:DrawSection({
    Name = "Rods",
    Position = "left"
})

local shopRight = Shop:DrawSection({
    Name = "Baits & Items",
    Position = "right"
})

-- Rod Selection Dropdown
shopLeft:AddDropdown({
    Name = "Select Rods",
    Values = {
        "Starter Rod",
        "Luck Rod",
        "Carbon Rod",
        "Grass Rod",
        "Demascus Rod",
        "Ice Rod",
        "Lucky Rod",
        "Midnight Rod",
        "Steampunk Rod",
        "Chrome Rod",
        "Astral Rod"
    },
    Default = {},
    Multi = true,
    Flag = "selected_rods",
    Callback = function(values)
        getgenv().SelectedRods = values
    end
})

-- Purchase Rods Button
shopLeft:AddButton({
    Name = "Purchase Rods",
    Callback = function()
        pcall(function()
            local rodMap = {
                ["Starter Rod"] = 1,
                ["Luck Rod"] = 79,
                ["Carbon Rod"] = 76,
                ["Grass Rod"] = 85,
                ["Demascus Rod"] = 77,
                ["Ice Rod"] = 78,
                ["Lucky Rod"] = 4,
                ["Midnight Rod"] = 80,
                ["Steampunk Rod"] = 6,
                ["Chrome Rod"] = 7,
                ["Astral Rod"] = 5
            }
            
            local selectedRods = getgenv().SelectedRods or {}
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            local purchaseRod = Net:WaitForChild("RF/PurchaseFishingRod")
            
            if purchaseRod and #selectedRods > 0 then
                for _, rodName in ipairs(selectedRods) do
                    local rodId = rodMap[rodName]
                    if rodId then
                        purchaseRod:InvokeServer(rodId)
                    end
                end
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Success",
                    Text = "Rods purchased successfully",
                    Duration = 3
                })
            end
        end)
    end
})

-- Bait Selection Dropdown
shopRight:AddDropdown({
    Name = "Select Baits",
    Values = {
        "Topwater Bait",
        "Luck Bait",
        "Midnight Bait",
        "Nature Bait",
        "Chroma Bait",
        "Dark Matter Bait",
        "Corrupt Bait",
        "Aether Bait"
    },
    Default = {},
    Multi = true,
    Flag = "selected_baits",
    Callback = function(values)
        getgenv().SelectedBaits = values
    end
})

-- Purchase Baits Button
shopRight:AddButton({
    Name = "Purchase Baits",
    Callback = function()
        pcall(function()
            local baitMap = {
                ["Topwater Bait"] = 10,
                ["Luck Bait"] = 2,
                ["Midnight Bait"] = 3,
                ["Nature Bait"] = 17,
                ["Chroma Bait"] = 6,
                ["Dark Matter Bait"] = 8,
                ["Corrupt Bait"] = 15,
                ["Aether Bait"] = 16
            }
            
            local selectedBaits = getgenv().SelectedBaits or {}
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            local purchaseBait = Net:WaitForChild("RF/PurchaseBait")
            
            if purchaseBait and #selectedBaits > 0 then
                for _, baitName in ipairs(selectedBaits) do
                    local baitId = baitMap[baitName]
                    if baitId then
                        purchaseBait:InvokeServer(baitId)
                    end
                end
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Success",
                    Text = "Baits purchased successfully",
                    Duration = 3
                })
            end
        end)
    end
})

-- Weather Selection Dropdown
shopRight:AddDropdown({
    Name = "Select Weather",
    Values = {"Snow", "Wind", "Cloudy", "Storm", "Radiant", "Shark Hunt"},
    Default = {},
    Multi = true,
    Flag = "selected_weather",
    Callback = function(values)
        getgenv().SelectedWeather = values
    end
})

-- Purchase Weather Button
shopRight:AddButton({
    Name = "Purchase Weather",
    Callback = function()
        pcall(function()
            local selectedWeather = getgenv().SelectedWeather or {}
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            local purchaseWeather = Net:WaitForChild("RF/PurchaseWeatherEvent")
            
            if purchaseWeather and #selectedWeather > 0 then
                for _, weatherName in ipairs(selectedWeather) do
                    purchaseWeather:InvokeServer(weatherName)
                end
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Success",
                    Text = "Weather purchased successfully",
                    Duration = 3
                })
            end
        end)
    end
})

-- Boat Tab Sections
local boatLeft = Boat:DrawSection({
    Name = "Purchase",
    Position = "left"
})

local boatRight = Boat:DrawSection({
    Name = "Spawn",
    Position = "right"
})

-- Boat Purchase Dropdown
boatLeft:AddDropdown({
    Name = "Select Boat",
    Values = {
        "Small Boat $300",
        "Kayak $1100",
        "Jetski $7500",
        "Highfield Boat $25000",
        "Speed Boat $70000",
        "Fishing Boat $180000",
        "Mini Yacht $1200000",
        "Mini Hoverboat $195 Robux",
        "Hyper Boat $999 Robux"
    },
    Default = "Small Boat $300",
    Flag = "purchase_boat",
    Callback = function(value)
        getgenv().PurchaseBoat = value
    end
})

-- Purchase Boat Button
boatLeft:AddButton({
    Name = "Purchase Boat",
    Callback = function()
        pcall(function()
            local boatMap = {
                ["Small Boat $300"] = 1,
                ["Kayak $1100"] = 2,
                ["Jetski $7500"] = 3,
                ["Highfield Boat $25000"] = 4,
                ["Speed Boat $70000"] = 5,
                ["Fishing Boat $180000"] = 6,
                ["Mini Yacht $1200000"] = 14,
                ["Mini Hoverboat $195 Robux"] = 15,
                ["Hyper Boat $999 Robux"] = 7
            }
            
            local boatName = getgenv().PurchaseBoat or "Small Boat $300"
            local boatId = boatMap[boatName]
            
            if boatId then
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                local purchaseBoat = Net:WaitForChild("RF/PurchaseBoat")
                
                if purchaseBoat then
                    purchaseBoat:InvokeServer(boatId)
                    game.StarterGui:SetCore("SendNotification", {
                        Title = "Success",
                        Text = "Boat purchased successfully",
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- Boat Spawn Dropdown
boatRight:AddDropdown({
    Name = "Select Boat to Spawn",
    Values = {
        "Small Boat",
        "Kayak",
        "Jetski",
        "Highfield Boat",
        "Speed Boat",
        "Fishing Boat",
        "Mini Yacht",
        "Mini Hoverboat",
        "Hyper Boat",
        "Dinky Fishing Boat",
        "Aura Boat",
        "Burger Boat",
        "Mega Hovercraft",
        "Froen Boat",
        "Cruiser Boat",
        "Rubber Ducky"
    },
    Default = "Small Boat",
    Flag = "spawn_boat",
    Callback = function(value)
        getgenv().SpawnBoat = value
    end
})

-- Spawn Boat Button
boatRight:AddButton({
    Name = "Spawn Boat",
    Callback = function()
        pcall(function()
            local boatMap = {
                ["Small Boat"] = 1,
                ["Kayak"] = 2,
                ["Jetski"] = 3,
                ["Highfield Boat"] = 4,
                ["Speed Boat"] = 5,
                ["Fishing Boat"] = 6,
                ["Mini Yacht"] = 14,
                ["Mini Hoverboat"] = 15,
                ["Hyper Boat"] = 7,
                ["Dinky Fishing Boat"] = 20,
                ["Aura Boat"] = 17,
                ["Burger Boat"] = 18,
                ["Mega Hovercraft"] = 19,
                ["Froen Boat"] = 11,
                ["Cruiser Boat"] = 13,
                ["Rubber Ducky"] = 16
            }
            
            local boatName = getgenv().SpawnBoat or "Small Boat"
            local boatId = boatMap[boatName]
            
            if boatId then
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                local spawnBoat = Net:WaitForChild("RF/SpawnBoat")
                
                if spawnBoat then
                    spawnBoat:InvokeServer(boatId)
                    game.StarterGui:SetCore("SendNotification", {
                        Title = "Success",
                        Text = "Boat spawned successfully",
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- Player Tab Sections
local playerLeft = Player:DrawSection({
    Name = "Enhancements",
    Position = "left"
})

local playerRight = Player:DrawSection({
    Name = "Visual",
    Position = "right"
})

-- Bypass Oxygen Tank Toggle
playerLeft:AddToggle({
    Name = "Bypass Oxygen Tank",
    Default = false,
    Flag = "bypass_oxygen",
    Callback = function(state)
        pcall(function()
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            
            if state then
                local equipOxygen = Net:WaitForChild("RF/EquipOxygenTank")
                if equipOxygen then
                    equipOxygen:InvokeServer(105)
                end
            else
                local unequipOxygen = Net:WaitForChild("RF/UnequipOxygenTank")
                if unequipOxygen then
                    unequipOxygen:InvokeServer()
                end
            end
        end)
    end
})

-- Bypass Radar Toggle
playerLeft:AddToggle({
    Name = "Bypass Radar",
    Default = false,
    Flag = "bypass_radar",
    Callback = function(state)
        pcall(function()
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            local Net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
            local updateRadar = Net:WaitForChild("RF/UpdateFishingRadar")
            
            if updateRadar then
                updateRadar:InvokeServer(state)
            end
        end)
    end
})

-- Performance Optimization - FIXED AND WORKING
playerRight:AddDropdown({
    Name = "Optimization Level",
    Values = {"Off", "Light", "Medium", "Heavy"},
    Default = "Medium",
    Flag = "optimization_level",
    Callback = function(level)
        getgenv().OptimizationLevel = level
    end
})

playerRight:AddButton({
    Name = "Apply Optimization",
    Callback = function()
        local level = getgenv().OptimizationLevel or "Medium"
        
        if level == "Off" then
            -- Restore original settings
            if getgenv().OriginalLightingSettings then
                local original = getgenv().OriginalLightingSettings
                game.Lighting.GlobalShadows = original.GlobalShadows
                game.Lighting.FogEnd = original.FogEnd
                game.Lighting.ShadowSoftness = original.ShadowSoftness
                game.Lighting.Brightness = original.Brightness
                game.Lighting.Ambient = original.Ambient
                game.Lighting.OutdoorAmbient = original.OutdoorAmbient
                game.Lighting.ExposureCompensation = original.ExposureCompensation
            end
            
            -- Re-enable particle effects
            for _, obj in ipairs(workspace:GetDescendants()) do
                if obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
                    obj.Enabled = true
                end
            end
            
            game.StarterGui:SetCore("SendNotification", {
                Title = "Optimized",
                Text = "Optimization disabled. Restored original settings.",
                Duration = 3
            })
            return
        end
        
        -- Save original settings if not already saved
        if not getgenv().OriginalLightingSettings then
            getgenv().OriginalLightingSettings = {
                GlobalShadows = game.Lighting.GlobalShadows,
                FogEnd = game.Lighting.FogEnd,
                ShadowSoftness = game.Lighting.ShadowSoftness,
                Brightness = game.Lighting.Brightness,
                Ambient = game.Lighting.Ambient,
                OutdoorAmbient = game.Lighting.OutdoorAmbient,
                ExposureCompensation = game.Lighting.ExposureCompensation
            }
        end
        
        -- Apply optimization settings
        if level == "Light" then
            game.Lighting.GlobalShadows = false
            game.Lighting.FogEnd = 1000
            game.Lighting.ShadowSoftness = 0.5
            game.Lighting.Brightness = 0.9
            game.Lighting.Ambient = Color3.new(0.2, 0.2, 0.2)
            game.Lighting.OutdoorAmbient = Color3.new(0.3, 0.3, 0.3)
            game.Lighting.ExposureCompensation = 0
            
        elseif level == "Medium" then
            game.Lighting.GlobalShadows = false
            game.Lighting.FogEnd = 500
            game.Lighting.ShadowSoftness = 0
            game.Lighting.Brightness = 0.8
            game.Lighting.Ambient = Color3.new(0.1, 0.1, 0.1)
            game.Lighting.OutdoorAmbient = Color3.new(0.2, 0.2, 0.2)
            game.Lighting.ExposureCompensation = -0.1
            
        elseif level == "Heavy" then
            game.Lighting.GlobalShadows = false
            game.Lighting.FogEnd = 200
            game.Lighting.ShadowSoftness = 0
            game.Lighting.Brightness = 0.6
            game.Lighting.Ambient = Color3.new(0, 0, 0)
            game.Lighting.OutdoorAmbient = Color3.new(0.1, 0.1, 0.1)
            game.Lighting.ExposureCompensation = -0.2
        end
        
        -- Only disable non-essential particles
        local disabledCount = 0
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
                if not obj.Name:match("Essential") and not obj.Name:match("Critical") then
                    obj.Enabled = false
                    disabledCount = disabledCount + 1
                end
            end
        end
        
        game.StarterGui:SetCore("SendNotification", {
            Title = "Optimized",
            Text = level .. " optimization applied successfully! Disabled " .. disabledCount .. " non-essential effects.",
            Duration = 3
        })
    end
})

-- Anti Lag Button
playerRight:AddButton({
    Name = "Anti Lag",
    Callback = function()
        pcall(function()
            -- Basic optimization settings
            game.Lighting.GlobalShadows = false
            game.Lighting.FogEnd = 9e9
            game.Lighting.Brightness = 1
            
            -- Disable most particle effects
            for _, obj in ipairs(workspace:GetDescendants()) do
                if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") then
                    obj.Enabled = false
                end
            end
            
            game.StarterGui:SetCore("SendNotification", {
                Title = "Anti Lag",
                Text = "Basic lag reduction applied successfully!",
                Duration = 3
            })
        end)
    end
})

-- Teleport Tab Sections
local teleportLeft = Teleport:DrawSection({
    Name = "Islands",
    Position = "left"
})

local teleportRight = Teleport:DrawSection({
    Name = "NPCs",
    Position = "right"
})

-- Island Selection Dropdown
teleportLeft:AddDropdown({
    Name = "Select Island",
    Values = {
        "Kohana",
        "Winter Fest",
        "Lost Isle",
        "Isoteric Island",
        "Crater Island",
        "Coral Reefs",
        "Kohana Volcano",
        "Fisherman Island",
        "Esoteric Depths",
        "Tropical Grove",
        "Treasure Room",
        "Weather Machine",
        "Sisyphus Statue"
    },
    Default = "Kohana",
    Flag = "selected_island",
    Callback = function(value)
        getgenv().SelectedIsland = value
    end
})

-- Teleport to Island Button
teleportLeft:AddButton({
    Name = "Teleport Now",
    Callback = function()
        pcall(function()
            local islandMap = {
                ["Kohana"] = CFrame.new(-642.243561, 16.0354481, 624.918884),
                ["Winter Fest"] = CFrame.new(1687.93079, 6.8625145, 3309.67725),
                ["Lost Isle"] = CFrame.new(-3660.07031, 26.1918774, -933.131897),
                ["Isoteric Island"] = CFrame.new(2029.47913, 27.3972206, 1393.52319),
                ["Crater Island"] = CFrame.new(973.268372, 7.36203814, 4879.09277),
                ["Coral Reefs"] = CFrame.new(-3134.98511, 20.9564934, 2167.80566),
                ["Kohana Volcano"] = CFrame.new(-525.122925, 24.0000591, 187.470749),
                ["Fisherman Island"] = CFrame.new(33.5687256, 17.0335217, 2834.95557),
                ["Esoteric Depths"] = CFrame.new(3152.74707, -1302.72986, 1438.05444),
                ["Tropical Grove"] = CFrame.new(-2046.1554, 6.26801682, 3660.56006),
                ["Treasure Room"] = CFrame.new(-3599.53491, -266.57373, -1566.98657),
                ["Weather Machine"] = CFrame.new(-1525.72632, 6.49999952, 1892.23645),
                ["Sisyphus Statue"] = CFrame.new(-3692.22021, -135.574417, -1026.96167)
            }
            
            local islandName = getgenv().SelectedIsland or "Kohana"
            local islandCFrame = islandMap[islandName]
            
            if islandCFrame then
                local player = game.Players.LocalPlayer
                local char = player.Character or player.CharacterAdded:Wait()
                local hrp = char:FindFirstChild("HumanoidRootPart")
                
                if hrp then
                    char:PivotTo(islandCFrame)
                    game.StarterGui:SetCore("SendNotification", {
                        Title = "Teleported",
                        Text = "Successfully teleported to " .. islandName,
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- NPC Selection Dropdown
teleportRight:AddDropdown({
    Name = "Select NPC",
    Values = {
        "Jones",
        "McBoatson",
        "Tim",
        "Scientist",
        "Lava Fisherman"
    },
    Default = "Jones",
    Flag = "selected_npc",
    Callback = function(value)
        getgenv().SelectedNPC = value
    end
})

-- Teleport to NPC Button
teleportRight:AddButton({
    Name = "Teleport Now",
    Callback = function()
        pcall(function()
            local npcMap = {
                ["Jones"] = CFrame.new(-678.315857, 16.4103374, 595.322937),
                ["McBoatson"] = CFrame.new(-627.383911, 3.04580736, 719.454956),
                ["Tim"] = CFrame.new(-595.170044, 16.3734112, 608.429932),
                ["Scientist"] = CFrame.new(-7.82026434, 14.6700287, 2885.70532),
                ["Lava Fisherman"] = CFrame.new(-595.716797, 59.000061, 135.618927)
            }
            
            local npcName = getgenv().SelectedNPC or "Jones"
            local npcCFrame = npcMap[npcName]
            
            if npcCFrame then
                local player = game.Players.LocalPlayer
                local char = player.Character or player.CharacterAdded:Wait()
                local hrp = char:FindFirstChild("HumanoidRootPart")
                
                if hrp then
                    char:PivotTo(npcCFrame)
                    game.StarterGui:SetCore("SendNotification", {
                        Title = "Teleported",
                        Text = "Successfully teleported to " .. npcName,
                        Duration = 3
                    })
                end
            end
        end)
    end
})

-- Server Tab Sections
local serverLeft = Server:DrawSection({
    Name = "Server Tools",
    Position = "left"
})

-- Anti Staff Toggle
serverLeft:AddToggle({
    Name = "Anti Staff",
    Default = true,
    Flag = "anti_staff",
    Callback = function(state)
        getgenv().AntiStaff = state
        game.StarterGui:SetCore("SendNotification", {
            Title = state and "Enabled" or "Disabled",
            Text = "Anti Staff protection " .. (state and "activated" or "deactivated"),
            Duration = 3
        })
    end
})

-- Rejoin Server Button
serverLeft:AddButton({
    Name = "Rejoin Server",
    Callback = function()
        pcall(function()
            local TeleportService = game:GetService("TeleportService")
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            
            TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
        end)
    end
})

-- Server Hop Button
serverLeft:AddButton({
    Name = "Server Hop",
    Callback = function()
        pcall(function()
            local TeleportService = game:GetService("TeleportService")
            local Players = game:GetService("Players")
            local LocalPlayer = Players.LocalPlayer
            local HttpService = game:GetService("HttpService")
            
            local url = ("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Asc&limit=100"):format(game.PlaceId)
            local response = game:HttpGet(url)
            local servers = HttpService:JSONDecode(response)
            
            for _, server in ipairs(servers.data) do
                if server.playing < server.maxPlayers and server.id ~= game.JobId then
                    TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, LocalPlayer)
                    return
                end
            end
            
            game.StarterGui:SetCore("SendNotification", {
                Title = "Error",
                Text = "No available servers found",
                Duration = 3
            })
        end)
    end
})

-- Copy Server ID Button
serverLeft:AddButton({
    Name = "Copy Server ID",
    Callback = function()
        setclipboard(game.JobId)
        game.StarterGui:SetCore("SendNotification", {
            Title = "Copied!",
            Text = "Server ID copied to clipboard",
            Duration = 3
        })
    end
})

-- Config Manager
local Configs = Window:DrawConfig({
    Name = "Configs",
    Icon = "folder",
    Config = FileWatcher
})

Configs:Init()

-- Initialize global variables
getgenv().AdvancedFishing = false
getgenv().AutoSell = false
getgenv().AutoFishingPro = false
getgenv().AntiStaff = true
getgenv().SellDelay = 2
getgenv().SelectedRods = {}
getgenv().SelectedBaits = {}
getgenv().SelectedWeather = {}
getgenv().PurchaseBoat = "Small Boat $300"
getgenv().SpawnBoat = "Small Boat"
getgenv().SelectedIsland = "Kohana"
getgenv().SelectedNPC = "Jones"
getgenv().OptimizationLevel = "Medium"
getgenv().FishingDelay = 1.0
getgenv().AntiBanEnabled = true

-- Cleanup on character removal
game:GetService("Players").LocalPlayer.CharacterRemoving:Connect(function()
    getgenv().AdvancedFishing = false
    getgenv().AutoSell = false
    getgenv().AutoFishingPro = false
    
    -- Remove any physics objects
    local char = game.Players.LocalPlayer.Character
    if char then
        for _, obj in ipairs(char:GetDescendants()) do
            if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then
                obj:Destroy()
            end
        end
    end
    
    -- Restore lighting settings
    if getgenv().OriginalLightingSettings then
        local original = getgenv().OriginalLightingSettings
        game.Lighting.GlobalShadows = original.GlobalShadows
        game.Lighting.FogEnd = original.FogEnd
        game.Lighting.ShadowSoftness = original.ShadowSoftness
        game.Lighting.Brightness = original.Brightness
    end
    
    -- Re-enable particle effects
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
            obj.Enabled = true
        end
    end
end)

-- Initialize with notification
game.StarterGui:SetCore("SendNotification", {
    Title = "Loaded",
    Text = "Souls Hub v2.0.0 loaded successfully!",
    Duration = 5
})

Window:Draw()
