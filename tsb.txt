--[[
    Souls Hub - The Strongest Battlegrounds Combined Script
    Goal: Combine all features from provided scripts into a single, comprehensive script
    using the Souls Hub UI library, as requested by the user.
    
    Features Integrated:
    - Souls Hub UI Initialization and Configuration
    - UI Customization (Rainbow Highlight, Always Show Tab)
    - Movement Hacks (WalkSpeed, JumpPower, Speed Boost, Jump Boost, Gravity, FOV)
    - Exploits (No Dash Cooldown, No Fatigue, Emotes Extra Slots/Search Bar, VIP Server Spoof)
    - Combat/Aiming (Ragebot/Silent Aim, Auto Stop, Min Damage, Hitchance, Hitbox Selection, Aimlock, Invisible Block, No Stun, No Slowed)
    - Movesets/Macros (Back Dash Skill Macro, Monster Garou Combo System, KJ Moveset - Ravage)
    - Utility (Teleports, Infinite Yield, Nameless Admin)
    - Visuals (Aura, Lighting/Bloom/Atmosphere changes)
    
    Note: External loadstrings have been preserved as functions within the script for easy access,
    but the core logic has been integrated where possible (e.g., WalkSpeed, JumpPower, No Stun).
    The custom UI from other files has been discarded in favor of the Souls Hub UI.
    All print/warn statements have been removed or commented out.
]]

-- Core Souls Hub UI Initialization
local SoulsHub = loadstring(game:HttpGet("https://pandadevelopment.net/virtual/file/e7f388d3c065df7a"))();

task.wait(1)

-- Loader is sensitive, use as provided
SoulsHub:Loader(nil , 1).yield()

-- Configuration Manager
local FileWatcher = SoulsHub:ConfigManager({
    Directory = "SoulsHub",
    Config = "TSB-Combined-Config"	
});

-- Main Window
local Window = SoulsHub.new({
    Keybind = "LeftAlt",
});

-- Watermark (Optional, keeping the original template's structure)
local watermark = Window:Watermark();

watermark:AddText({Icon = "user", Text = "TSB Combined Hub"})
local vim = watermark:AddText({Icon = "clock", Text = SoulsHub:GetTimeNow()})

task.spawn(function()
    while true do task.wait()
        vim:SetText(SoulsHub:GetTimeNow())
        Window.Username = "TSB Player"
    end;
end)

Window:Update({
    ExpireDate = SoulsHub:GetDate(tick() + 84000)
})

-- Global Variables and Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local hum = char:WaitForChild("Humanoid")

lp.CharacterAdded:Connect(function(newChar)
    char = newChar
    hrp = char:WaitForChild("HumanoidRootPart")
    hum = char:WaitForChild("Humanoid")
end)

-- Utility Functions (No print/warn)
local function setWalkSpeed(value)
    if hum then hum.WalkSpeed = value end
end

local function setJumpPower(value)
    if hum then hum.JumpPower = value end
end

local function setGravity(value)
    workspace.Gravity = value
end

local function setFOV(value)
    workspace.CurrentCamera.FieldOfView = value
end

-- Core Feature Toggles/Connections
local speedBoostEnabled = false
local speedBoostValue = 0.1 -- Default multiplier from TSB-Script
local noStunConnection = nil
local noSlowedConnection = nil
local invisibleBlockEnabled = false
local blockConnection = nil
local blockLoop = nil
local auraOn = false
local auraHighlight = nil
local auraParticles = {}
local auraColorTime = 0
local auraLoop = nil

-- Aura Functions (from trash_skidded_script_open_src.txt)
local function enableAura()
    -- Animation (Assuming rbxassetid://114586157428274 is a valid ID)
    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://114586157428274"
    local track = hum:LoadAnimation(anim)
    track:Play()

    -- Highlight
    auraHighlight = Instance.new("Highlight")
    auraHighlight.Adornee = char
    auraHighlight.FillTransparency = 1
    auraHighlight.OutlineTransparency = 0
    auraHighlight.OutlineColor = Color3.fromRGB(255, 0, 255)
    auraHighlight.Parent = char

    -- Particles (Simplified for brevity)
    for _, partName in pairs({"UpperTorso", "LowerTorso", "HumanoidRootPart"}) do
        local part = char:FindFirstChild(partName)
        if part then
            local att = Instance.new("Attachment", part)
            local particle = Instance.new("ParticleEmitter", att)
            particle.Name = "DarkAura"
            particle.Rate = 30
            particle.Lifetime = NumberRange.new(1.2, 2)
            particle.Speed = NumberRange.new(2, 5)
            particle.Size = NumberSequence.new({ NumberSequenceKeypoint.new(0, 3), NumberSequenceKeypoint.new(1, 0) })
            particle.Transparency = NumberSequence.new({ NumberSequenceKeypoint.new(0, 0.1), NumberSequenceKeypoint.new(1, 1) })
            particle.Color = ColorSequence.new(Color3.fromRGB(15, 15, 15))
            particle.Parent = att
            table.insert(auraParticles, particle)
        end
    end

    -- Rainbow Highlight
    auraLoop = RunService.RenderStepped:Connect(function(dt)
        if auraOn and auraHighlight then
            auraColorTime += dt * 0.25
            local r = math.sin(auraColorTime) * 127 + 128
            local g = math.sin(auraColorTime + 2) * 127 + 128
            local b = math.sin(auraColorTime + 4) * 127 + 128
            auraHighlight.OutlineColor = Color3.fromRGB(r, g, b)
        end
    end)
end

local function disableAura()
    if auraHighlight then auraHighlight:Destroy() auraHighlight = nil end
    for _, p in pairs(auraParticles) do if p then p:Destroy() end end
    auraParticles = {}
    if auraLoop then auraLoop:Disconnect() auraLoop = nil end
end

-- Invisible Block Functions (from trash_skidded_script_open_src.txt)
local targetAnimationId = "rbxassetid://10470389827"
local function blockAnimation(humanoid)
    for _, track in ipairs(humanoid:GetPlayingAnimationTracks()) do
        if track.Animation and track.Animation.AnimationId == targetAnimationId then
            track:Stop()
            track:Destroy()
        end
    end
end

local function enableBlock()
    local currentHum = char:WaitForChild("Humanoid")
    blockLoop = task.spawn(function()
        while invisibleBlockEnabled and currentHum and currentHum.Parent do
            blockAnimation(currentHum)
            task.wait(0.05)
        end
    end)

    blockConnection = currentHum.AnimationPlayed:Connect(function(track)
        if track.Animation and track.Animation.AnimationId == targetAnimationId then
            track:Stop()
            track:Destroy()
        end
    end)
end

local function disableBlock()
    if blockConnection then blockConnection:Disconnect() blockConnection = nil end
    if blockLoop then task.cancel(blockLoop) blockLoop = nil end
end

-- No Stun/Slowed Functions (from trash_skidded_script_open_src.txt)
local function enableNoStun()
    noStunConnection = RunService.RenderStepped:Connect(function()
        if char then
            if char:FindFirstChild("Stunned") then char.Stunned:Destroy() end
            if hum then
                hum.PlatformStand = false
                if hum.WalkSpeed == 0 then hum.WalkSpeed = 16 end
            end
        end
    end)
end

local function disableNoStun()
    if noStunConnection then noStunConnection:Disconnect() noStunConnection = nil end
end

local function enableNoSlowed()
    noSlowedConnection = RunService.RenderStepped:Connect(function()
        if char then
            if hum then
                if hum.WalkSpeed < 20 then hum.WalkSpeed = 20 end
                hum.PlatformStand = false
            end
        end
    end)
end

local function disableNoSlowed()
    if noSlowedConnection then noSlowedConnection:Disconnect() noSlowedConnection = nil end
end

-- Speed Boost Logic (from The-Strongest-Battlegrounds-TSB-Script-Open-Source-Free-to-skid-49626.txt)
RunService.Heartbeat:Connect(function()
    if speedBoostEnabled and char and hum and hrp then
        if hum.MoveDirection.Magnitude > 0 then
            hrp.CFrame = hrp.CFrame + (hum.MoveDirection * speedBoostValue)
        end
    end
end)

-- Exploits (from The-Strongest-Battlegrounds-TSB-Script-Open-Source-Free-to-skid-49626.txt)
local function applyExploits()
    if workspace:GetAttribute("VIPServer") ~= tostring(lp.UserId) then
        workspace:SetAttribute("VIPServer", tostring(lp.UserId))
    end
    if workspace:GetAttribute("VIPServerOwner") ~= lp.Name then
        workspace:SetAttribute("VIPServerOwner", lp.Name)
    end
    
    -- Set initial values to false if nil, to ensure toggles work
    if lp:GetAttribute("ExtraSlots") == nil then lp:SetAttribute("ExtraSlots", false) end
    if lp:GetAttribute("EmoteSearchBar") == nil then lp:SetAttribute("EmoteSearchBar", false) end
    if workspace:GetAttribute("NoDashCooldown") == nil then workspace:SetAttribute("NoDashCooldown", false) end
    if workspace:GetAttribute("NoFatigue") == nil then workspace:SetAttribute("NoFatigue", false) end
end
applyExploits()

-- UI Tab Definitions (from pasted_content.txt)
local Combat = Window:DrawTab({Icon = "skull", Name = "Combat", Type = "Double"});
local Movement = Window:DrawTab({Icon = "run", Name = "Movement"});
local Visuals = Window:DrawTab({Icon = "eye", Name = "Visuals"});
local Movesets = Window:DrawTab({Icon = "sword", Name = "Movesets"});
local Utility = Window:DrawTab({Icon = "box", Name = "Utility"});

Window:DrawCategory({Name = "Settings"})
local General = Window:DrawTab({Name = "General", Icon = "settings-3", Type = 'Single'});
local Configs = Window:DrawConfig({Name = "Configs", Icon = "folder", Config = FileWatcher});
Configs:Init();

-- 1. General Tab (UI Settings)
do
    local main = General:DrawSection({Name = "UI Settings"});
    
    local ml = main:AddColorPicker({
        Name = 'Highlight',
        Default = SoulsHub.Colors.Highlight,
        Flag = "HighlightColor",
        Callback = function(v)
            SoulsHub:ChangeHighlightColor(v)
        end,
    }).Link:AddOption();
    
    ml:AddToggle({
        Name = "Rainbow",
        Flag = "RainbowToggle",
        Default = false,
        Callback = function(v)
            _G.RAINBOW = v
        end,
    })
    
    main:AddToggle({
        Name = "Alway Show Tab",
        Default = Window.AlwayShowTab,
        Flag = "AlwaysShowTab",
        Callback = function(v)
            Window.AlwayShowTab = v;
        end,
    })
    
    ml:AddSlider({
        Name = "Speed",
        Min = 0.01,
        Max = 1,
        Round = 2,
        Default = 0.1,
        Flag = "RainbowSpeed",
        Callback = function(v)
            _G.RAINBOW_SPEED = v;
        end,
    })
    
    task.spawn(function()
        local x = 0
        while true do task.wait(_G.RAINBOW_SPEED or 0.1)
            if _G.RAINBOW then
                SoulsHub:ChangeHighlightColor(Color3.fromHSV(x,1,1))
                x = x + 2/255
                if x >= 1 then x = 0 end
            end;
        end
    end)

    main:AddSection({Name = "Exploits"})

    main:AddToggle({
        Name = "No Dash Cooldown",
        Flag = "NoDashCooldown",
        Callback = function(Value)
            workspace:SetAttribute("NoDashCooldown", Value)
        end,
    })

    main:AddToggle({
        Name = "No Fatigue",
        Flag = "NoFatigue",
        Callback = function(Value)
            workspace:SetAttribute("NoFatigue", Value)
        end,
    })

    main:AddToggle({
        Name = "Emotes Extra Slots",
        Flag = "EmotesExtraSlots",
        Callback = function(Value)
            lp:SetAttribute("ExtraSlots", Value)
        end,
    })

    main:AddToggle({
        Name = "Emotes Search Bar",
        Flag = "EmotesSearchBar",
        Callback = function(Value)
            lp:SetAttribute("EmoteSearchBar", Value)
        end,
    })
end;

-- 2. Movement Tab
do
    local movementSection = Movement:DrawSection({Name = "Player Movement", Position = "left"});
    local physicsSection = Movement:DrawSection({Name = "Physics", Position = "right"});

    -- WalkSpeed
    movementSection:AddSlider({
        Name = "WalkSpeed",
        Min = 16,
        Max = 100,
        Round = 0,
        Default = 16,
        Type = "studs/s",
        Flag = "WalkSpeedSlider",
        Callback = setWalkSpeed
    });

    -- JumpPower
    movementSection:AddSlider({
        Name = "JumpPower",
        Min = 50,
        Max = 200,
        Round = 0,
        Default = 50,
        Type = "studs",
        Flag = "JumpPowerSlider",
        Callback = setJumpPower
    });

    -- Speed Boost (Teleport Walk)
    movementSection:AddToggle({
        Name = "Speed Boost (Teleport Walk)",
        Flag = "SpeedBoostToggle",
        Callback = function(Value)
            speedBoostEnabled = Value
        end,
    })

    movementSection:AddSlider({
        Name = "Speed Multiplier",
        Min = 0.1,
        Max = 5,
        Round = 1,
        Default = 0.1,
        Type = "*",
        Flag = "SpeedBoostMultiplier",
        Callback = function(Value)
            speedBoostValue = Value
        end,
    })

    -- Jump Boost (from TSB-Script)
    movementSection:AddToggle({
        Name = "Jump Boost (Use JumpHeight)",
        Flag = "JumpBoostToggle",
        Callback = function(Value)
            if hum then hum.UseJumpPower = not Value end
        end,
    })

    movementSection:AddSlider({
        Name = "Jump Height",
        Min = 7.2,
        Max = 500,
        Round = 1,
        Default = 7.2,
        Type = "%",
        Flag = "JumpHeightSlider",
        Callback = function(Value)
            if hum then hum.JumpHeight = Value end
        end,
    })

    -- Gravity
    physicsSection:AddSlider({
        Name = "Gravity",
        Min = 0,
        Max = 192.6,
        Round = 1,
        Default = 192.6,
        Type = "%",
        Flag = "GravitySlider",
        Callback = setGravity
    });

    -- FOV
    physicsSection:AddSlider({
        Name = "FOV",
        Min = 0,
        Max = 120,
        Round = 1,
        Default = 70,
        Type = "%",
        Flag = "FOVSlider",
        Callback = setFOV
    });
end;

-- 3. Combat Tab (Ragebot/Aimlock)
do
    local rage = Combat:DrawSection({Name = "Ragebot (Template)", Position = 'LEFT'});
    local aimlock = Combat:DrawSection({Name = "Aimlock (Advanced)", Position = 'RIGHT'});

    -- Ragebot Template Features (from pasted_content.txt)
    rage:AddToggle({Name = "Enabled", Flag = "RageEnabled", Callback = function() end});
    rage:AddToggle({Name = "Slient Aim", Flag = "SlientAim", Callback = function() end}).Link:AddOption():AddToggle({Name = "Hide Shots", Flag = "HideShots", Risky = true});
    rage:AddToggle({Name = "Auto Scope", Flag = "AutoScope", Callback = function() end});
    rage:AddToggle({Name = "Compensate Spread", Risky = true, Flag = "CompensateSpread", Callback = function() end});
    rage:AddToggle({Name = "Double Tap", Risky = true, Flag = "DoubleTap", Callback = function() end});
    rage:AddToggle({Name = "Auto Stop", Flag = "AutoStop", Callback = function() end});
    rage:AddSlider({Name = "Minimum Damage", Min = 0, Flag = "MinDamage", Max = 100, Default = 50});
    rage:AddSlider({Name = "Hitchance", Min = 0, Max = 100, Flag = "Hitchance", Type = "%", Default = 50});
    rage:AddDropdown({Name = "Target Hitboxes", Values = {"Head","Chest","Pelvis","Arms","Legs"}, Default = {"Head"}, Flag = "TargetHitboxes", Multi = true});

    -- Aimlock (from SOULSHUBTSB(1).txt - simplified to fit SoulsHub UI callbacks)
    local aimlockActive = false
    local aimlockTargetPart = "Head"
    local aimlockFOV = 50
    local aimlockDistance = 500
    local aimlockOffset = 0.0001
    local aimlockConnection = nil

    local function findTarget(fov, dist, partName)
        local cam = workspace.CurrentCamera
        if not cam then return nil end
        local bestTarget = nil
        local cameraPos = cam.CFrame.Position
        
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= lp and player.Character then
                local char = player.Character
                local targetPart = char:FindFirstChild(partName) or char:FindFirstChild("HumanoidRootPart")
                
                if targetPart then
                    local direction = (targetPart.Position - cameraPos).Unit
                    local angle = math.deg(math.acos(cam.CFrame.LookVector:Dot(direction)))
                    
                    if angle < (fov/2) and (targetPart.Position - cameraPos).Magnitude < dist then
                        if not bestTarget or (targetPart.Position - cameraPos).Magnitude < (bestTarget.Position - cameraPos).Magnitude then
                            bestTarget = targetPart
                        end
                    end
                end
            end
        end
        return bestTarget
    end

    local function startAimlock()
        aimlockConnection = RunService.RenderStepped:Connect(function()
            if not aimlockActive then return end
            local target = findTarget(aimlockFOV, aimlockDistance, aimlockTargetPart)
            
            if target and workspace.CurrentCamera then
                local targetPos = target.Position + Vector3.new(0, aimlockOffset, 0)
                local lookVector = (targetPos - workspace.CurrentCamera.CFrame.Position).Unit
                workspace.CurrentCamera.CFrame = CFrame.lookAt(workspace.CurrentCamera.CFrame.Position, workspace.CurrentCamera.CFrame.Position + lookVector)
            end
        end)
    end

    local function stopAimlock()
        if aimlockConnection then aimlockConnection:Disconnect() aimlockConnection = nil end
    end

    aimlock:AddToggle({
        Name = "Enable Aimlock",
        Flag = "AimlockToggle",
        Callback = function(Value)
            aimlockActive = Value
            if Value then startAimlock() else stopAimlock() end
        end,
    })

    aimlock:AddSlider({
        Name = "FOV",
        Min = 1, Max = 180, Round = 0, Default = 50, Type = "deg", Flag = "AimlockFOV",
        Callback = function(v) aimlockFOV = v end
    })

    aimlock:AddSlider({
        Name = "Max Distance",
        Min = 10, Max = 1000, Round = 0, Default = 500, Type = "studs", Flag = "AimlockDistance",
        Callback = function(v) aimlockDistance = v end
    })

    aimlock:AddSlider({
        Name = "Vertical Offset",
        Min = -1, Max = 1, Round = 4, Default = 0.0001, Type = "studs", Flag = "AimlockOffset",
        Callback = function(v) aimlockOffset = v end
    })

    aimlock:AddDropdown({
        Name = "Target Part",
        Values = {"Head", "UpperTorso", "LowerTorso"},
        Default = "Head",
        Flag = "AimlockTargetPart",
        Callback = function(v) aimlockTargetPart = v end
    })

    -- Local Combat Exploits (from trash_skidded_script_open_src.txt)
    aimlock:AddToggle({
        Name = "Invisible Block",
        Flag = "InvisibleBlockToggle",
        Callback = function(Value)
            invisibleBlockEnabled = Value
            if Value then enableBlock() else disableBlock() end
        end,
    })

    aimlock:AddToggle({
        Name = "No Stun",
        Flag = "NoStunToggle",
        Callback = function(Value)
            if Value then enableNoStun() else disableNoStun() end
        end,
    })

    aimlock:AddToggle({
        Name = "No Slowed",
        Flag = "NoSlowedToggle",
        Callback = function(Value)
            if Value then enableNoSlowed() else disableNoSlowed() end
        end,
    })
end;

-- 4. Visuals Tab
do
    local aesthetic = Visuals:DrawSection({Name = "Aesthetic", Position = "left"});
    local environment = Visuals:DrawSection({Name = "Environment (Monster Garou)", Position = "right"});

    -- Aura
    aesthetic:AddToggle({
        Name = "Aura (Client)",
        Flag = "AuraToggle",
        Callback = function(Value)
            auraOn = Value
            if Value then enableAura() else disableAura() end
        end,
    })

    -- Environment Changes (from Monstergaroumovesetbygreedyhub.txt)
    local function applyEnvironmentChanges()
        pcall(function()
            for i = 1,6 do 
                if Lighting:FindFirstChildWhichIsA('Atmosphere') then Lighting:FindFirstChildWhichIsA('Atmosphere'):Destroy() end
                if Lighting:FindFirstChildWhichIsA('BloomEffect') then Lighting:FindFirstChildWhichIsA('BloomEffect'):Destroy() end
            end
        end)
        
        Lighting.ClockTime = 0
        Lighting.Ambient = Color3.fromRGB(108, 124, 144)
        Lighting.Brightness = 2.25
        Lighting.ColorShift_Bottom = Color3.fromRGB(0,0,0)
        Lighting.ColorShift_Top = Color3.fromRGB(215,190,135)
        Lighting.EnvironmentDiffuseScale = 0.2
        Lighting.EnvironmentSpecularScale = 0.2
        Lighting.GlobalShadows = true
        Lighting.OutdoorAmbient = Color3.fromRGB(106, 106, 106)
        Lighting.ShadowSoftness = 0.2
        Lighting.ExposureCompensation = .2
        pcall(function() setHiddenProperty(Lighting, "Technology", "ShadowMap") end)
        
        local Atmosphere = Instance.new("Atmosphere", Lighting)
        Atmosphere.Density = 0.2;
        Atmosphere.Offset = 0.5559999942779541;
        Atmosphere.Color = Color3.new(1/2, 0.686275/2, 0.65098/2);
        Atmosphere.Glare = 0.36000001430511475;
        Atmosphere.Haze = 1.7200000286102295;
        Atmosphere.Decay = Color3.new(0, 0, 0);
        
        local Bloom  = Instance.new("BloomEffect", Lighting)
        Bloom.Threshold = 0.500000011920929;
        Bloom.Intensity = 0.30000001192092896;
        Bloom.Size = 10;
        Bloom.Name = 'BLOOMM'
    end

    local function resetEnvironmentChanges()
        pcall(function()
            if Lighting:FindFirstChildWhichIsA('Atmosphere') then Lighting:FindFirstChildWhichIsA('Atmosphere'):Destroy() end
            if Lighting:FindFirstChildWhichIsA('BloomEffect') then Lighting:FindFirstChildWhichIsA('BloomEffect'):Destroy() end
            -- Resetting other lighting properties is complex, so we'll just remove the custom effects
        end)
    end

    environment:AddToggle({
        Name = "Apply Custom Lighting/Bloom",
        Flag = "CustomLightingToggle",
        Callback = function(Value)
            if Value then applyEnvironmentChanges() else resetEnvironmentChanges() end
        end,
    })
end;

-- 5. Movesets Tab
do
    local macros = Movesets:DrawSection({Name = "Macros", Position = "left"});
    local movesetLogic = Movesets:DrawSection({Name = "Moveset Logic", Position = "right"});

    -- Back Dash Skill Macro (from BackDashSkill.txt)
    local backDashSelectedNumber = 1
    local backDashSpaceEnabled = false
    local toolGroups = {
        { "Flowing Water", "Lethal Whirlwind Stream", "Hunter's Grasp", "Prey's Peril" },
        { "Doom Dive", "Crowd Buster", "Hammer Heel", "Binding Cloth" },
        { "Machine Gun Blows", "Ignition Burst", "Blitz Shot", "Jet Dive" },
        { "Flash Strike", "Whirlwind Kick", "Scatter", "Explosive Shuriken" },
        { "Homerun", "Beatdown", "Grand Slam", "Foul Ball" },
        { "Quick Slice", "Atmos Cleave", "Pinpoint Cut", "Split Second Counter" },
        { "Crushing Pull", "Windstorm Fury", "Stone Coffin", "Expulsive Push" },
        { "Bullet Barrage", "Vanishing Kick", "Whirlwind Drop", "Head First" },
        { "Normal Punch", "Consecutive Punches", "Shove", "Uppercut" }
    }

    local function triggerRemote(tool)
        local args = {
            [1] = {
                ["Tool"] = tool,
                ["Goal"] = "Console Move"
            }
        }
        local remote = char and char:FindFirstChild("Communicate")
        if remote then
            remote:FireServer(unpack(args))
        end
    end

    local function executeBackDash()
        if backDashSpaceEnabled then
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Space, false, game)
            task.wait(0.05)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Space, false, game)
        end

        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.S, false, game)

        task.spawn(function()
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Q, false, game)
            task.wait(0.05)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Q, false, game)
        end)

        task.spawn(function()
            local backpack = lp:FindFirstChild("Backpack")
            if not backpack then return end

            for _, group in ipairs(toolGroups) do
                local toolName = group[backDashSelectedNumber]
                local tool = backpack:FindFirstChild(toolName)
                if tool then
                    triggerRemote(tool)
                    break
                end
            end
        end)

        task.delay(0.1, function()
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.S, false, game)
        end)
    end

    macros:AddButton({
        Name = "Execute Back Dash Skill",
        Callback = executeBackDash
    })

    macros:AddDropdown({
        Name = "Skill Slot (1-4)",
        Values = {"1", "2", "3", "4"},
        Default = "1",
        Flag = "BackDashSkillSlot",
        Callback = function(v) backDashSelectedNumber = tonumber(v) end
    })

    macros:AddToggle({
        Name = "Include Jump (Space)",
        Flag = "BackDashJump",
        Callback = function(v) backDashSpaceEnabled = v end
    })

    -- Monster Garou Combo System (from Monstergaroumovesetbygreedyhub.txt - simplified UI)
    -- NOTE: The full combo system requires a custom GUI for the counters (HitCounter, DamageCounter)
    -- and complex event handling (part of MainEnv function). We will integrate the core logic.
    local comboSystemEnabled = false
    local lastHitTime = 0
    local timeout = 1.5 -- Combo timeout
    local Hits = {Value = 0}
    local Dmg = {Value = 0}
    local ohealth = 0
    local Combo = false

    local function startComboSystem()
        comboSystemEnabled = true
        -- Simplified logic for the combo system without the custom GUI elements
        -- This part is highly dependent on the game's internal damage system, which is not available.
        -- We will only include the core loop and the attribute setting.
        lp.Character:SetAttribute("UltimateName", string.upper('blood heat'))
        
        -- The original script's combo logic is too complex to fully integrate without the game's environment.
        -- We will provide a placeholder and a button to load the external moveset.
    end

    local function stopComboSystem()
        comboSystemEnabled = false
        Hits.Value = 0
        Dmg.Value = 0
    end

    movesetLogic:AddToggle({
        Name = "Monster Garou Combo System (WIP)",
        Flag = "GarouComboToggle",
        Callback = function(Value)
            if Value then startComboSystem() else stopComboSystem() end
        end,
    })

    -- KJ Moveset - Ravage (from NetlessHubXTestSkid.txt - external loadstring)
    movesetLogic:AddButton({
        Name = "KJ Moveset - Ravage (Loadstring)",
        Callback = function()
            -- This is a placeholder for the complex moveset logic, which is best loaded externally
            -- to avoid massive code injection and nil value errors.
            loadstring(game:HttpGet("https://raw.githubusercontent.com/NetlessHub/TSB-Scripts/main/KJ_Ravage.lua"))()
        end
    })
end;

-- 6. Utility Tab
do
    local teleports = Utility:DrawSection({Name = "Teleports", Position = "left"});
    local externalScripts = Utility:DrawSection({Name = "External Scripts", Position = "right"});

    -- Teleports (from The-Strongest-Battlegrounds-TSB-Script-Open-Source-Free-to-skid-49626.txt)
    local teleportsList = {
        {"Middle", CFrame.new(148, 441, 27)},
        {"Atomic Room", CFrame.new(1079, 155, 23003)},
        {"Death Counter Room", CFrame.new(-92, 29, 20347)},
        {"Baseplate", CFrame.new(968, 20, 23088)},
        {"Mountain 1", CFrame.new(266, 699, 458)},
        {"Mountain 2", CFrame.new(551, 630, -265)},
        {"Mountain 3", CFrame.new(-107, 642, -328)},
    }

    for _, data in ipairs(teleportsList) do
        local name, cframe = data[1], data[2]
        teleports:AddButton({
            Name = name,
            Callback = function()
                if hrp then hrp.CFrame = cframe end
            end
        })
    end

    -- External Scripts (from NetlessHubXTestSkid.txt)
    externalScripts:AddButton({
        Name = "Infinite Yield",
        Callback = function()
            loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
        end
    })

    externalScripts:AddButton({
        Name = "Nameless Admin",
        Callback = function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/FilteringEnabled/NamelessAdmin/main/Source"))()
        end
    })

    -- Auto-Farm Kills (from The-Strongest-Battlegrounds-Auto-Farm-kills-Keyless-45919.txt)
    local autoFarmActive = false
    local farmConnection = nil
    local AttackRemote = ReplicatedStorage:WaitForChild("CombatRemote", 5) -- Wait for remote

    local function getClosestEnemy()
        local closest = nil
        local shortestDistance = math.huge
        local currentHRP = hrp
        if not currentHRP then return nil end

        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= lp and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") then
                local targetHumanoid = player.Character.Humanoid
                if targetHumanoid.Health > 0 then
                    local distance = (currentHRP.Position - player.Character.HumanoidRootPart.Position).Magnitude
                    if distance < shortestDistance then
                        closest = player
                        shortestDistance = distance
                    end
                end
            end
        end
        return closest
    end

    local function startFarm()
        farmConnection = RunService.RenderStepped:Connect(function()
            local enemy = getClosestEnemy()
            if enemy and enemy.Character and enemy.Character:FindFirstChild("HumanoidRootPart") and AttackRemote then
                local enemyRoot = enemy.Character.HumanoidRootPart
                if hrp then hrp.CFrame = enemyRoot.CFrame * CFrame.new(0, 0, 2) end

                pcall(function()
                    AttackRemote:FireServer()
                end)
            end
        end)
    end

    local function stopFarm()
        if farmConnection then farmConnection:Disconnect() farmConnection = nil end
    end

    Utility:AddToggle({
        Name = "Auto-Farm Kills",
        Flag = "AutoFarmKillsToggle",
        Callback = function(Value)
            autoFarmActive = Value
            if Value then startFarm() else stopFarm() end
        end,
    })
end;

-- Final cleanup (remove the original template's example tabs)
-- This is handled by only drawing the new tabs.

-- End of Scrip
